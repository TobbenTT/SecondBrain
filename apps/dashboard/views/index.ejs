<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Value Strategy Consulting - Hub Interno de Operaciones">
    <title>VSC Hub ‚Äî Dashboard Interno</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/custom_modal.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/css/premium_cards.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="/css/premium_docs.css" media="print" onload="this.media='all'">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <script defer src="https://cdn.jsdelivr.net/npm/dompurify@3.2.4/dist/purify.min.js"></script>
    <script defer src="https://unpkg.com/@simplewebauthn/browser@11/dist/bundle/index.umd.min.js"></script>
</head>

<body>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">VSC</div>
                <div class="logo-text">
                    <span class="logo-title">ValueStrategy</span>
                    <span class="logo-sub">Consulting Hub</span>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <span class="nav-label">Principal</span>
                <a href="#home" class="nav-link active" data-section="home">
                    <span class="nav-icon">üè†</span>
                    Inicio
                </a>
                <a href="#overview" class="nav-link" data-section="overview">
                    <span class="nav-icon">üìä</span>
                    Dashboard General
                </a>
                <a href="#analytics" class="nav-link" data-section="analytics">
                    <span class="nav-icon">üìà</span>
                    Indicadores y Metricas
                </a>
            </div>
            <div class="nav-section">
                <span class="nav-label">Gestion Operativa</span>
                <a href="#projects" class="nav-link" data-section="projects">
                    <span class="nav-icon">üöÄ</span>
                    Proyectos
                </a>
                <a href="#areas" class="nav-link" data-section="areas">
                    <span class="nav-icon">üè¢</span>
                    Areas
                </a>
                <a href="#reuniones" class="nav-link" data-section="reuniones">
                    <span class="nav-icon">üìÖ</span>
                    Reuniones
                </a>
                <a href="#waiting" class="nav-link" data-section="waiting">
                    <span class="nav-icon">‚è≥</span>
                    Delegaciones y Seguimiento
                </a>
                <a href="#okrs" class="nav-link" data-section="okrs">
                    <span class="nav-icon">üèÜ</span>
                    OKRs
                </a>
            </div>
            <div class="nav-section">
                <span class="nav-label">Captura e Ideas</span>
                <a href="#inbox" class="nav-link" data-section="inbox">
                    <span class="nav-icon">üì•</span>
                    Bandeja de Ideas
                    <span class="inbox-badge" id="inboxBadge" style="display:none;"></span>
                </a>
                <a href="#ideas" class="nav-link" data-section="ideas">
                    <span class="nav-icon">üí°</span>
                    Ideas Capturadas
                </a>
            </div>
            <div class="nav-section">
                <span class="nav-label">Documentos</span>
                <a href="#archivos" class="nav-link" data-section="archivos">
                    <span class="nav-icon">üìÑ</span>
                    Recursos y Documentos
                </a>
                <a href="#context" class="nav-link" data-section="context">
                    <span class="nav-icon">üß†</span>
                    Base de Conocimiento
                </a>
            </div>
            <div class="nav-section">
                <span class="nav-label">Herramientas</span>
                <a href="#skills" class="nav-link" data-section="skills">
                    <span class="nav-icon">üìö</span>
                    Skills
                </a>
                <a href="#methodologies" class="nav-link" data-section="methodologies">
                    <span class="nav-icon">üìê</span>
                    Metodologias
                </a>
                <a href="#agents" class="nav-link" data-section="agents">
                    <span class="nav-icon">ü§ñ</span>
                    Agentes IA
                </a>
                <a href="#openclaw" class="nav-link" data-section="openclaw">
                    <span class="nav-icon">ü¶û</span>
                    Monitor de Procesos IA
                </a>
            </div>
            <div class="nav-section">
                <span class="nav-label">Planificacion (GTD)</span>
                <a href="#gtd-board" class="nav-link" data-section="gtd-board">
                    <span class="nav-icon">üéØ</span>
                    Proximas Acciones
                </a>
                <a href="#gtd-projects" class="nav-link" data-section="gtd-projects">
                    <span class="nav-icon">üìÇ</span>
                    Proyectos GTD
                </a>
                <a href="#gtd-report" class="nav-link" data-section="gtd-report">
                    <span class="nav-icon">üì∞</span>
                    Reporte Diario
                </a>
            </div>
            <div class="nav-section">
                <span class="nav-label">Equipo y Seguimiento</span>
                <a href="#reportability" class="nav-link" data-section="reportability">
                    <span class="nav-icon">üìã</span>
                    Avance del Equipo
                </a>
                <a href="#revision" class="nav-link" data-section="revision">
                    <span class="nav-icon">üìù</span>
                    Revision de Entregables
                </a>
                <a href="#feedback" class="nav-link" data-section="feedback">
                    <span class="nav-icon">üí¨</span>
                    Sugerencias y Mejoras
                </a>
            </div>
            <% if (user && (user.role === 'admin' || user.role === 'ceo')) { %>
            <div class="nav-section">
                <span class="nav-label">ADMIN</span>
                <a href="#admin-users" class="nav-link" data-section="admin-users">
                    <span class="nav-icon">üë•</span>
                    Usuarios
                </a>
                <a href="#graph-view" class="nav-link" data-section="graph-view">
                    <span class="nav-icon">üï∏Ô∏è</span>
                    Mapa de Conexiones
                </a>
                <a href="#herramientas" class="nav-link" data-section="herramientas">
                    <span class="nav-icon">üõ†Ô∏è</span>
                    Suscripciones y Licencias
                </a>
                <a href="#audit-log" class="nav-link" data-section="audit-log">
                    <span class="nav-icon">üìã</span>
                    Auditoria
                </a>
                <a href="#admin-files" class="nav-link" data-section="admin-files">
                    <span class="nav-icon">üìÇ</span>
                    Gestor de Archivos
                </a>
            </div>
            <% } %>
        </nav>

        <div class="sidebar-footer">
            <div class="sidebar-status">
                <span class="status-dot"></span>
                <span>Sistema Activo</span>
            </div>
            <div class="sidebar-status ollama-status" id="ollamaStatus" title="Estado del LLM local">
                <span class="ollama-dot" id="ollamaDot"></span>
                <span id="ollamaLabel">Ollama: ...</span>
            </div>
            <a href="/logout" class="logout-link" title="Cerrar sesi√≥n">üîí Salir</a>
        </div>
    </aside>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MOBILE TOPBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="topbar" id="topbar">
        <button class="sidebar-toggle" id="sidebarToggle" aria-label="Menu">‚ò∞</button>
        <div class="topbar-logo">
            <div class="logo-icon sm">VSC</div>
            <span>ValueStrategy Hub</span>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN CONTENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <main class="main-content" id="mainContent">

        <!-- ‚îÄ‚îÄ‚îÄ Top Bar ‚îÄ‚îÄ‚îÄ -->
        <header class="content-header">
            <div class="header-left">
                <h1 class="page-title" id="pageTitle">Bienvenido</h1>
                <p class="page-subtitle" id="pageSubtitle">Hub Interno de Operaciones</p>
            </div>
            <div class="header-right">
                <!-- Global Search -->
                <div class="global-search" id="globalSearch">
                    <span class="global-search-icon">üîç</span>
                    <input type="text" id="globalSearchInput" class="global-search-input" placeholder="Buscar en todo..." autocomplete="off">
                    <kbd class="global-search-kbd">Ctrl+K</kbd>
                    <div class="global-search-results" id="globalSearchResults" style="display:none;"></div>
                </div>
                <!-- Notification Bell -->
                <div class="notification-wrapper">
                    <button class="notification-bell" id="notificationBell" title="Notificaciones">
                        üîî <span class="notification-badge" id="notificationBadge" style="display:none;">0</span>
                    </button>
                    <div class="notification-dropdown" id="notificationDropdown" style="display:none;">
                        <div class="notification-header">Notificaciones</div>
                        <div class="notification-list" id="notificationList"></div>
                    </div>
                </div>
                <button class="theme-toggle" id="themeToggle" title="Cambiar tema">
                    <span class="theme-icon" id="themeIcon">üåô</span>
                </button>
                <div class="header-badge">
                    <span class="badge-dot"></span>
                    Hub Interno v2.3
                </div>
                <!-- User Profile Display -->
                <% if (user) { %>
                    <div class="user-profile" onclick="openProfileModal()" style="cursor:pointer" title="Editar perfil">
                        <div class="user-avatar" id="sidebarAvatar">
                            <img src="<%= user.avatar || '/img/vsc.png' %>" alt="avatar">
                        </div>
                        <div class="user-info">
                            <span class="user-name"><%= user.username %></span>
                            <span class="user-role"><%= user.role %></span>
                        </div>
                    </div>
                <% } %>
                        <div class="header-date" id="headerDate"></div>
            </div>
        </header>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: HOME
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section active" id="section-home">

            <!-- Hero -->
            <div class="home-hero">
                <div class="home-hero-bg"></div>
                <div class="home-hero-content">
                    <p class="home-hero-label">VALUE STRATEGY CONSULTING</p>
                    <h2 class="home-hero-title">Hub Interno de<br>Operaciones</h2>
                    <p class="home-hero-greeting" id="homeGreeting"></p>
                    <div class="home-hero-divider"></div>
                    <p class="home-hero-tagline">
                        Plataforma centralizada para gestionar proyectos, documentacion,
                        metodologias y skills del equipo.
                    </p>
                </div>
            </div>

            <!-- Stats Strip -->
            <div class="home-stats-strip">
                <div class="hss-item hss-clickable" onclick="switchSection('projects')">
                    <span class="hss-num" id="homeStatProjects">‚Äî</span>
                    <span class="hss-label">Proyectos</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item hss-clickable" onclick="switchSection('archivos')">
                    <span class="hss-num" id="homeStatDocs">‚Äî</span>
                    <span class="hss-label">Documentos</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item hss-clickable" onclick="switchSection('ideas')">
                    <span class="hss-num" id="homeStatIdeas">‚Äî</span>
                    <span class="hss-label">Ideas Capturadas</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item hss-clickable" onclick="switchSection('areas')">
                    <span class="hss-num" id="homeStatAreas">‚Äî</span>
                    <span class="hss-label">Areas Activas</span>
                </div>
            </div>

            <!-- Daily Digest Widget -->
            <div id="digestWidget" style="margin-bottom:20px;"></div>

            <!-- Personal Dashboard -->
            <div class="home-personal" id="homePersonal">
                <div class="hp-grid">
                    <div class="hp-card">
                        <div class="hp-card-header">
                            <h4 class="hp-card-title">Mis Tareas</h4>
                            <div class="hp-task-summary" id="hpTaskSummary"></div>
                        </div>
                        <div class="hp-card-body" id="hpTaskList">
                            <div class="loading-sm"><div class="spinner-sm"></div></div>
                        </div>
                        <div class="hp-card-footer">
                            <a href="#ideas" onclick="switchSection('ideas')" class="hp-link">Ver todas ‚Üí</a>
                        </div>
                    </div>
                    <div class="hp-card">
                        <div class="hp-card-header">
                            <h4 class="hp-card-title">Delegaciones Pendientes</h4>
                        </div>
                        <div class="hp-card-body" id="hpDelegations">
                            <div class="loading-sm"><div class="spinner-sm"></div></div>
                        </div>
                        <div class="hp-card-footer">
                            <a href="#waiting" onclick="switchSection('waiting')" class="hp-link">Ver delegaciones ‚Üí</a>
                        </div>
                    </div>
                    <div class="hp-card">
                        <div class="hp-card-header">
                            <h4 class="hp-card-title">Reuniones Recientes</h4>
                        </div>
                        <div class="hp-card-body" id="hpReuniones">
                            <div class="loading-sm"><div class="spinner-sm"></div></div>
                        </div>
                        <div class="hp-card-footer">
                            <a href="#reuniones" onclick="switchSection('reuniones')" class="hp-link">Ver reuniones ‚Üí</a>
                        </div>
                    </div>
                    <div class="hp-card hp-card-wide">
                        <div class="hp-card-header">
                            <h4 class="hp-card-title">Actividad Reciente</h4>
                        </div>
                        <div class="hp-card-body" id="hpActivity">
                            <div class="loading-sm"><div class="spinner-sm"></div></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Team -->
            <div class="home-team-section">
                <h3 class="home-section-title">Nuestro Equipo</h3>
                <div class="home-team-grid" id="homeTeamGrid">
                    <div class="loading-sm"><div class="spinner-sm"></div></div>
                </div>
            </div>

            <!-- Gallery -->
            <div class="home-gallery-section" id="homeGallerySection">
                <div class="home-gallery-header">
                    <h3 class="home-section-title">Galeria</h3>
                    <div class="gallery-header-actions">
                        <div class="gallery-filter-tabs" id="galleryFilterTabs">
                            <button class="gallery-filter-tab active" data-filter="all">Todas</button>
                            <button class="gallery-filter-tab" data-filter="equipo">Equipo</button>
                            <button class="gallery-filter-tab" data-filter="evento">Evento</button>
                            <button class="gallery-filter-tab" data-filter="reunion">Reunion</button>
                            <button class="gallery-filter-tab" data-filter="oficina">Oficina</button>
                        </div>
                        <% if (user && (user.role === 'admin' || user.role === 'ceo' || user.role === 'manager')) { %>
                        <button class="btn btn-sm" onclick="openGalleryUpload()">+ Subir Foto</button>
                        <% } %>
                    </div>
                </div>
                <div class="home-gallery-grid" id="homeGalleryGrid"></div>
                <div id="galleryUploadForm" class="gallery-upload-form" style="display:none;">
                    <div class="gallery-upload-row">
                        <div class="gallery-upload-field">
                            <label>Foto</label>
                            <input type="file" id="galleryFileInput" accept="image/*" class="search-input-sm" style="width:100%;">
                        </div>
                        <div class="gallery-upload-field">
                            <label>Descripcion</label>
                            <input type="text" id="galleryCaptionInput" placeholder="Ej: Reunion de equipo..." class="search-input-sm" style="width:100%;">
                        </div>
                        <div class="gallery-upload-field" style="min-width:120px;flex:0;">
                            <label>Categoria</label>
                            <select id="galleryCategoryInput" class="gtd-filter-select" style="width:100%;">
                                <option value="general">General</option>
                                <option value="equipo">Equipo</option>
                                <option value="evento">Evento</option>
                                <option value="reunion">Reunion</option>
                                <option value="oficina">Oficina</option>
                            </select>
                        </div>
                        <div class="gallery-upload-actions">
                            <button class="btn btn-sm btn-primary" onclick="uploadGalleryPhoto()">Subir</button>
                            <button class="btn btn-sm" onclick="document.getElementById('galleryUploadForm').style.display='none'">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gallery Lightbox -->
            <div class="gallery-lightbox" id="galleryLightbox">
                <button class="gallery-lightbox-close" onclick="closeLightbox()">&times;</button>
                <button class="gallery-lightbox-nav prev" onclick="navigateLightbox(-1)">&#8249;</button>
                <img id="lightboxImg" src="" alt="">
                <button class="gallery-lightbox-nav next" onclick="navigateLightbox(1)">&#8250;</button>
                <div class="gallery-lightbox-info" id="lightboxInfo"></div>
            </div>

            <!-- Quick Capture -->
            <div class="quick-capture-bar" id="quickCaptureBar">
                <div class="quick-capture-inner">
                    <span class="quick-capture-icon">üé§</span>
                    <input type="text" id="quickCaptureInput" class="quick-capture-input"
                        placeholder="Captura rapida ‚Äî escribe o habla..." autocomplete="off">
                    <button type="button" class="quick-capture-mic" id="quickCaptureMic" title="Hablar para capturar">
                        <span id="quickCaptureMicIcon">üé§</span>
                    </button>
                    <button type="button" class="quick-capture-send" id="quickCaptureSend" title="Guardar">
                        ‚û§
                    </button>
                </div>
                <span class="quick-capture-hint" id="quickCaptureHint">Ctrl+Shift+V desde cualquier seccion</span>
            </div>

            <% if (user && (user.role === 'admin' || user.role === 'ceo')) { %>
            <div style="text-align:center;margin-top:20px;">
                <button class="btn btn-sm" id="btnSeedData" onclick="seedDemoData()" style="opacity:0.6;">üå± Sembrar datos de ejemplo</button>
            </div>
            <% } %>

        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: OVERVIEW (Dashboard General + Panel Ejecutivo)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-overview">

            <!-- Executive KPI Cards -->
            <div class="exec-kpi-row" id="execKpiRow">
                <div class="exec-kpi-card exec-kpi-blue" onclick="switchSection('projects')">
                    <div class="exec-kpi-top">
                        <span class="exec-kpi-icon">üöÄ</span>
                        <span class="exec-kpi-trend" id="kpiProjectsTrend"></span>
                    </div>
                    <div class="exec-kpi-value" id="kpiProjectsActive">‚Äî</div>
                    <div class="exec-kpi-label">Proyectos Activos</div>
                    <div class="exec-kpi-bar-wrap">
                        <div class="exec-kpi-bar" id="kpiProjectsBar" style="width:0%"></div>
                    </div>
                    <div class="exec-kpi-sub" id="kpiProjectsSub"></div>
                </div>
                <div class="exec-kpi-card exec-kpi-amber" onclick="switchSection('ideas')">
                    <div class="exec-kpi-top">
                        <span class="exec-kpi-icon">üí°</span>
                        <span class="exec-kpi-trend" id="kpiIdeasTrend"></span>
                    </div>
                    <div class="exec-kpi-value" id="kpiIdeasTotal">‚Äî</div>
                    <div class="exec-kpi-label">Ideas Totales</div>
                    <div class="exec-kpi-bar-wrap">
                        <div class="exec-kpi-bar" id="kpiIdeasBar" style="width:0%"></div>
                    </div>
                    <div class="exec-kpi-sub" id="kpiIdeasSub"></div>
                </div>
                <div class="exec-kpi-card exec-kpi-red" onclick="switchSection('waiting')">
                    <div class="exec-kpi-top">
                        <span class="exec-kpi-icon">üìã</span>
                    </div>
                    <div class="exec-kpi-value" id="kpiCompromisos">‚Äî</div>
                    <div class="exec-kpi-label">Compromisos Abiertos</div>
                    <div class="exec-kpi-bar-wrap">
                        <div class="exec-kpi-bar" id="kpiCompromisosBar" style="width:0%"></div>
                    </div>
                    <div class="exec-kpi-sub" id="kpiCompromisosSub"></div>
                </div>
                <div class="exec-kpi-card exec-kpi-green" onclick="switchSection('reuniones')">
                    <div class="exec-kpi-top">
                        <span class="exec-kpi-icon">üìÖ</span>
                    </div>
                    <div class="exec-kpi-value" id="kpiReuniones">‚Äî</div>
                    <div class="exec-kpi-label">Reuniones (7d)</div>
                    <div class="exec-kpi-bar-wrap">
                        <div class="exec-kpi-bar" id="kpiReunionesBar" style="width:0%"></div>
                    </div>
                    <div class="exec-kpi-sub" id="kpiReunionesSub"></div>
                </div>
            </div>

            <!-- Executive Charts Row -->
            <div class="exec-main-grid" style="margin-bottom:16px;">
                <div class="exec-panel">
                    <div class="exec-panel-header">
                        <h4>Estado de Proyectos</h4>
                        <button class="panel-action" onclick="switchSection('projects')">Ver todos ‚Üí</button>
                    </div>
                    <div class="exec-panel-body">
                        <div class="exec-chart-wrap" style="height:180px;"><canvas id="execChartProjects"></canvas></div>
                    </div>
                </div>
                <div class="exec-panel">
                    <div class="exec-panel-header">
                        <h4>Pipeline de Ideas</h4>
                        <button class="panel-action" onclick="switchSection('ideas')">Ver todas ‚Üí</button>
                    </div>
                    <div class="exec-panel-body">
                        <div class="exec-pipeline" id="execPipeline"></div>
                    </div>
                </div>
            </div>

            <!-- Proyectos Prioritarios -->
            <div class="exec-panel" style="margin:0 0 16px;">
                <div class="exec-panel-header">
                    <h4>Proyectos Prioritarios</h4>
                    <button class="panel-action" onclick="switchSection('projects')">Ver todos ‚Üí</button>
                </div>
                <div class="exec-panel-body">
                    <div id="execTopProjects" class="exec-top-projects">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>

            <!-- Processing Pipeline -->
            <div class="ov-pipeline-panel">
                <div class="ov-pipeline-header">
                    <h2>Flujo de Procesamiento</h2>
                    <span>Pipeline de ideas ‚Äî desde captura hasta entregable</span>
                </div>
                <div class="ov-pipeline-track">
                    <div class="ov-pipeline-line"></div>
                    <div class="ov-stage" onclick="switchSection('ideas')">
                        <div class="ov-stage-ring captured"><span>üì•</span></div>
                        <div class="ov-stage-count" id="codeCaptured">0</div>
                        <div class="ov-stage-label">Capturadas</div>
                    </div>
                    <div class="ov-stage" onclick="switchSection('ideas')">
                        <div class="ov-stage-ring organized"><span>üìÇ</span></div>
                        <div class="ov-stage-count" id="codeOrganized">0</div>
                        <div class="ov-stage-label">Organizadas</div>
                    </div>
                    <div class="ov-stage" onclick="switchSection('ideas')">
                        <div class="ov-stage-ring distilled"><span>üíé</span></div>
                        <div class="ov-stage-count" id="codeDistilled">0</div>
                        <div class="ov-stage-label">Destiladas</div>
                    </div>
                    <div class="ov-stage" onclick="switchSection('ideas')">
                        <div class="ov-stage-ring expressed"><span>üöÄ</span></div>
                        <div class="ov-stage-count" id="codeExpressed">0</div>
                        <div class="ov-stage-label">Expresadas</div>
                    </div>
                </div>
            </div>

            <!-- Metrics + Actions -->
            <div class="ov-mid-row">
                <div class="ov-metrics-grid">
                    <div class="ov-metric" onclick="switchSection('projects')">
                        <div class="ov-metric-icon ov-icon-blue">üöÄ</div>
                        <div class="ov-metric-data">
                            <span class="ov-metric-num" id="statProjects">--</span>
                            <span class="ov-metric-label">Proyectos</span>
                        </div>
                    </div>
                    <div class="ov-metric" onclick="switchSection('areas')">
                        <div class="ov-metric-icon ov-icon-green">üìã</div>
                        <div class="ov-metric-data">
                            <span class="ov-metric-num" id="statAreas">--</span>
                            <span class="ov-metric-label">Areas</span>
                        </div>
                    </div>
                    <div class="ov-metric" onclick="switchSection('context')">
                        <div class="ov-metric-icon ov-icon-purple">üß†</div>
                        <div class="ov-metric-data">
                            <span class="ov-metric-num" id="statContext">--</span>
                            <span class="ov-metric-label">Conocimiento</span>
                        </div>
                    </div>
                    <div class="ov-metric" onclick="switchSection('waiting')">
                        <div class="ov-metric-icon ov-icon-amber">‚è≥</div>
                        <div class="ov-metric-data">
                            <span class="ov-metric-num" id="statWaiting">--</span>
                            <span class="ov-metric-label">A la Espera</span>
                        </div>
                    </div>
                </div>
                <div class="ov-actions">
                    <h4 class="ov-actions-title">Acciones Rapidas</h4>
                    <button class="ov-action-btn" id="btnDeepResearch" title="Analizar un tema complejo">
                        <span class="ov-action-icon">üïµÔ∏è</span>
                        <div class="ov-action-text"><strong>Investigaci√≥n Profunda</strong><span>Analizar un tema a fondo con IA</span></div>
                    </button>
                    <button class="ov-action-btn" id="btnWeeklyReview" title="Generar plan semanal">
                        <span class="ov-action-icon">üìÖ</span>
                        <div class="ov-action-text"><strong>Revisi√≥n Semanal</strong><span>Planificar la semana</span></div>
                    </button>
                    <button class="ov-action-btn" id="btnDigest" title="Generar resumen diario del equipo">
                        <span class="ov-action-icon">üì¨</span>
                        <div class="ov-action-text"><strong>Resumen Diario</strong><span>Resumen de actividad del equipo</span></div>
                    </button>
                </div>
            </div>

            <!-- Team Reportability Summary -->
            <div class="panel ov-team-panel">
                <div class="panel-header">
                    <h2 class="panel-title">üë• Avance del Equipo</h2>
                    <button class="panel-action" onclick="switchSection('reportability')">Ver detalle ‚Üí</button>
                </div>
                <div class="panel-body">
                    <div class="ov-team-strip" id="ovTeamSummary">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>

            <!-- Inbox + PARA + Reuniones -->
            <div class="ov-bottom-row">
                <div class="panel ov-inbox-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">üì¨ Registro de Ideas</h2>
                        <span class="inbox-log-count" id="inboxLogCount">0 entradas</span>
                    </div>
                    <div class="panel-body">
                        <div class="inbox-log-list" id="inboxLogList">
                            <div class="loading-sm"><div class="spinner-sm"></div></div>
                        </div>
                        <div class="pagination-controls" id="inboxPagination">
                            <button class="pagination-btn" id="inboxPrevPage" disabled>&larr; Anterior</button>
                            <span class="pagination-info" id="inboxPageInfo">Pagina 1</span>
                            <button class="pagination-btn" id="inboxNextPage">Siguiente &rarr;</button>
                        </div>
                    </div>
                </div>
                <div class="ov-right-col">
                    <div class="ov-para-panel">
                        <h4 class="ov-para-title">Distribuci√≥n Organizativa</h4>
                        <div class="ov-para-grid">
                            <div class="ov-para-card ov-para-projects" onclick="switchSection('projects')">
                                <span class="ov-para-icon">üöÄ</span>
                                <span class="ov-para-count" id="paraProjects">0</span>
                                <span class="ov-para-label">Proyectos</span>
                                <span class="ov-para-desc">Con deadline</span>
                            </div>
                            <div class="ov-para-card ov-para-areas" onclick="switchSection('areas')">
                                <span class="ov-para-icon">üìã</span>
                                <span class="ov-para-count" id="paraAreas">0</span>
                                <span class="ov-para-label">Areas</span>
                                <span class="ov-para-desc">Responsabilidades</span>
                            </div>
                            <div class="ov-para-card ov-para-resources" onclick="switchSection('archivos')">
                                <span class="ov-para-icon">üìö</span>
                                <span class="ov-para-count" id="paraResources">0</span>
                                <span class="ov-para-label">Recursos</span>
                                <span class="ov-para-desc">Referencia</span>
                            </div>
                            <div class="ov-para-card ov-para-archive">
                                <span class="ov-para-icon">üóÑÔ∏è</span>
                                <span class="ov-para-count" id="paraArchive">0</span>
                                <span class="ov-para-label">Archivo</span>
                                <span class="ov-para-desc">Inactivo</span>
                            </div>
                        </div>
                    </div>
                    <!-- Recent Reuniones mini-panel -->
                    <div class="panel ov-reuniones-mini">
                        <div class="panel-header">
                            <h2 class="panel-title">üìÖ Reuniones Recientes</h2>
                            <button class="panel-action" onclick="switchSection('reuniones')">Ver todas ‚Üí</button>
                        </div>
                        <div class="panel-body">
                            <div id="ovReunionesRecent">
                                <div class="loading-sm"><div class="spinner-sm"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: PROJECTS (dynamic)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-projects">

            <!-- Project Executive Summary -->
            <div class="home-stats-strip" id="projectStatsStrip">
                <div class="hss-item">
                    <span class="hss-num" id="projStatActive">‚Äî</span>
                    <span class="hss-label">Activos</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="projStatDev">‚Äî</span>
                    <span class="hss-label">En Desarrollo</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="projStatCompleted">‚Äî</span>
                    <span class="hss-label">Completados</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="projStatPaused">‚Äî</span>
                    <span class="hss-label">Pausados</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="projStatOverdue" style="color:#ef4444">‚Äî</span>
                    <span class="hss-label">Vencidos</span>
                </div>
            </div>

            <!-- Project Executive Summary -->
            <div class="proj-exec-summary" id="projExecSummary">
                <div class="proj-exec-bar-section">
                    <div class="proj-exec-bar-label">
                        <span>Tasa de Completado</span>
                        <strong id="projExecRate">0%</strong>
                    </div>
                    <div class="proj-exec-bar-wrap">
                        <div class="proj-exec-bar" id="projExecBar" style="width:0%"></div>
                    </div>
                </div>
                <div class="proj-exec-chips">
                    <div class="proj-exec-chip proj-exec-chip-blue">
                        <span class="proj-exec-chip-num" id="projExecInternal">0</span>
                        <span class="proj-exec-chip-label">Internos</span>
                    </div>
                    <div class="proj-exec-chip proj-exec-chip-purple">
                        <span class="proj-exec-chip-num" id="projExecClient">0</span>
                        <span class="proj-exec-chip-label">Clientes</span>
                    </div>
                    <div class="proj-exec-chip proj-exec-chip-amber">
                        <span class="proj-exec-chip-num" id="projExecWithDeadline">0</span>
                        <span class="proj-exec-chip-label">Con plazo</span>
                    </div>
                </div>
            </div>

            <!-- Add Project Panel -->
            <div class="panel add-project-panel">
                <div class="panel-header">
                    <h2 class="panel-title">‚ûï Agregar Proyecto</h2>
                    <button class="panel-action" id="toggleAddProject">Mostrar ‚Üì</button>
                </div>
                <div class="panel-body add-project-body" id="addProjectBody" style="display:none;">
                    <form class="add-project-form" id="addProjectForm">
                        <div class="apf-row">
                            <div class="apf-field">
                                <label>Tipo</label>
                                <select id="projType">
                                    <option value="interno">Interno</option>
                                    <option value="cliente">Cliente</option>
                                </select>
                            </div>
                            <div class="apf-field">
                                <label>Estado</label>
                                <select id="projStatus">
                                    <option value="active">‚óè Activo</option>
                                    <option value="beta">‚óè Beta</option>
                                    <option value="development">‚óè En Desarrollo</option>
                                    <option value="paused">‚óè Pausado</option>
                                    <option value="completed">‚óè Completado</option>
                                    <option value="review">‚óè En Revisi√≥n</option>
                                    <option value="cancelled">‚óè Cancelado</option>
                                </select>
                            </div>
                            <div class="apf-field">
                                <label>Icono (emoji)</label>
                                <input type="text" id="projIcon" placeholder="üöÄ" maxlength="4">
                            </div>
                        </div>
                        <div class="apf-row">
                            <div class="apf-field">
                                <label>Nombre *</label>
                                <input type="text" id="projName" placeholder="Mi Proyecto" required>
                            </div>
                            <div class="apf-field">
                                <label>URL</label>
                                <input type="url" id="projUrl" placeholder="http://localhost:3001 o https://...">
                            </div>
                        </div>
                        <div class="apf-row">
                            <div class="apf-field apf-wide">
                                <label>Descripci√≥n</label>
                                <input type="text" id="projDesc" placeholder="Breve descripci√≥n del proyecto...">
                            </div>
                        </div>
                        <!-- Client-specific fields (hidden when tipo=interno) -->
                        <div class="apf-row apf-client-fields" id="apfClientFields" style="display:none;">
                            <div class="apf-field">
                                <label>Cliente</label>
                                <input type="text" id="projClientName" placeholder="Nombre del cliente...">
                            </div>
                            <div class="apf-field">
                                <label>Geograf√≠a</label>
                                <input type="text" id="projGeography" placeholder="Chile, LATAM, Worldwide...">
                            </div>
                        </div>
                        <div class="apf-row">
                            <div class="apf-field">
                                <label>√Årea</label>
                                <select id="projArea">
                                    <option value="">‚Äî Sin √°rea ‚Äî</option>
                                </select>
                            </div>
                            <div class="apf-field">
                                <label>Horizonte</label>
                                <select id="projHorizon">
                                    <option value="">‚Äî Sin definir ‚Äî</option>
                                    <option value="corto">Corto plazo</option>
                                    <option value="medio">Medio plazo</option>
                                    <option value="largo">Largo plazo</option>
                                </select>
                            </div>
                            <div class="apf-field">
                                <label>Deadline</label>
                                <input type="date" id="projDeadline">
                            </div>
                        </div>
                        <div class="apf-row">
                            <div class="apf-field apf-wide">
                                <label>Equipo</label>
                                <div class="team-selector" id="projTeamSelector">
                                    <div class="team-selected-chips" id="projTeamChips"></div>
                                    <select id="projTeamAdd" class="team-add-select">
                                        <option value="">+ Agregar miembro...</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="apf-row">
                            <div class="apf-field apf-wide">
                                <label>Links (GitHub, Web, Video, etc.)</label>
                                <div class="proj-links-editor" id="projLinksEditor">
                                    <div class="proj-links-list" id="projLinksList"></div>
                                    <button type="button" class="btn btn-sm proj-add-link-btn" id="projAddLinkBtn">+ Agregar link</button>
                                </div>
                            </div>
                        </div>
                        <div class="apf-row">
                            <div class="apf-field apf-wide">
                                <label>Tecnolog√≠as (coma separadas)</label>
                                <input type="text" id="projTech" placeholder="Node.js, React, Python...">
                            </div>
                        </div>
                        <div class="apf-actions">
                            <button type="submit" class="btn btn-sm">Guardar Proyecto ‚úì</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Type filter -->
            <div class="proj-type-filter" id="projTypeFilter">
                <button class="skill-filter-chip active" data-ptypefilter="all">Todos</button>
                <button class="skill-filter-chip" data-ptypefilter="interno">Internos</button>
                <button class="skill-filter-chip" data-ptypefilter="cliente">Clientes</button>
            </div>

            <!-- Status Filters + Search -->
            <div class="projects-toolbar">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="projectSearch" placeholder="Buscar proyectos..." autocomplete="off">
                </div>
                <div class="filter-buttons" id="projectFilterBtns">
                    <button class="filter-btn active" data-pfilter="all">Todos</button>
                    <button class="filter-btn" data-pfilter="active">‚óè Activos</button>
                    <button class="filter-btn" data-pfilter="beta">‚óè Beta</button>
                    <button class="filter-btn" data-pfilter="development">‚óè Desarrollo</button>
                    <button class="filter-btn" data-pfilter="paused">‚óè Pausados</button>
                    <button class="filter-btn" data-pfilter="completed">‚óè Completados</button>
                    <button class="filter-btn" data-pfilter="review">‚óè Revisi√≥n</button>
                    <button class="filter-btn" data-pfilter="cancelled">‚óè Cancelados</button>
                </div>
            </div>

            <div id="projectsGrid">
                <div class="loading-sm">
                    <div class="spinner-sm"></div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: ARCHIVOS
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-archivos">

            <% if (user && ['admin', 'manager'].includes(user.role)) { %>
            <!-- Upload Panel (admin/manager only) -->
            <div class="panel upload-panel">
                <div class="panel-header">
                    <h2 class="panel-title">üì§ Subir Archivo</h2>
                    <button class="panel-action" id="toggleUpload">Mostrar ‚Üì</button>
                </div>
                <div class="panel-body upload-body" id="uploadBody" style="display:none;">
                    <form class="upload-form" id="uploadForm">
                        <div class="upload-row">
                            <div class="upload-dropzone" id="uploadDropzone">
                                <input type="file" id="uploadFile" accept=".md,.pdf,.txt,.docx" hidden>
                                <div class="dropzone-content">
                                    <span class="dropzone-icon">üìÅ</span>
                                    <p>Arrastra un archivo o <button type="button" class="dropzone-btn"
                                            id="uploadBrowse">explorar</button></p>
                                    <span class="dropzone-formats">.md, .pdf, .txt, .docx ‚Äî Max 50MB</span>
                                </div>
                                <div class="dropzone-selected" id="dropzoneSelected" style="display:none;">
                                    <span class="selected-icon">üìÑ</span>
                                    <span class="selected-name" id="selectedFileName"></span>
                                    <button type="button" class="selected-clear" id="clearFile">‚úï</button>
                                </div>
                            </div>
                        </div>
                        <div class="upload-row">
                            <div class="upload-tags-input">
                                <label class="upload-label">Tags (separados por coma)</label>
                                <input type="text" id="uploadTags" class="upload-text-input"
                                    placeholder="protocolo, git, estrategia...">
                            </div>
                            <button type="submit" class="btn btn-sm btn-upload" id="btnUpload" disabled>
                                Subir Archivo ‚Üë
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <% } %>

            <!-- Toolbar -->
            <div class="archivos-toolbar">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInput" placeholder="Buscar documentos..." autocomplete="off">
                </div>
                <div class="archivos-filter-chips" id="archivosFilterChips">
                    <button class="skill-filter-chip active" data-filter="all">Todos <span class="chip-count" id="archCountAll">0</span></button>
                    <button class="skill-filter-chip" data-filter="markdown">üìù Markdown <span class="chip-count" id="archCountMd">0</span></button>
                    <button class="skill-filter-chip" data-filter="pdf">üìï PDF <span class="chip-count" id="archCountPdf">0</span></button>
                    <button class="skill-filter-chip" data-filter="app">üöÄ Interactivas <span class="chip-count" id="archCountApp">0</span></button>
                    <button class="skill-filter-chip" data-filter="other">üìÑ Otros <span class="chip-count" id="archCountOther">0</span></button>
                    <span style="width:1px;height:20px;background:var(--border);margin:0 4px;"></span>
                    <button class="skill-filter-chip" data-filter="recent">üïê Recientes</button>
                    <button class="skill-filter-chip" data-filter="large">üì¶ Pesados</button>
                </div>
                <div style="display:flex;align-items:center;gap:6px;margin-top:6px;">
                    <label style="font-size:0.78rem;color:var(--text-muted);">Ordenar:</label>
                    <select id="archSortSelect" onchange="filterAndRender()" style="background:var(--bg-panel);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);padding:4px 8px;font-size:0.78rem;cursor:pointer;">
                        <option value="name">Nombre A-Z</option>
                        <option value="name-desc">Nombre Z-A</option>
                        <option value="date" selected>M√°s recientes</option>
                        <option value="date-asc">M√°s antiguos</option>
                        <option value="size">M√°s pesados</option>
                        <option value="size-asc">M√°s livianos</option>
                    </select>
                </div>
            </div>

            <!-- Tag Filter Bar -->
            <div class="tag-filter-bar" id="tagFilterBar"></div>

            <!-- Stats summary -->
            <div class="archivos-summary" id="archivosSummary"></div>

            <div class="archivos-grid" id="archivosGrid">
                <div class="loading-sm">
                    <div class="spinner-sm"></div>
                    <p>Cargando documentos...</p>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: AREAS (PARA)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-areas">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìã √Åreas de Responsabilidad</h2>
                    <button class="btn btn-sm" onclick="openAreaModal()">+ Nueva √Årea</button>
                </div>
                <div class="panel-body">
                    <div class="areas-grid" id="areasGrid">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Area Modal -->
        <div id="areaModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <span class="close-modal" onclick="closeAreaModal()">&times;</span>
                <h2 class="modal-title" id="areaModalTitle">Nueva √Årea</h2>
                <form id="areaForm">
                    <input type="hidden" id="areaId">
                    <div class="form-group">
                        <label>Nombre</label>
                        <input type="text" id="areaName" required placeholder="Ej: Operaciones">
                    </div>
                    <div class="form-group">
                        <label>Descripci√≥n</label>
                        <textarea id="areaDescription" rows="3" placeholder="Responsabilidades de esta √°rea..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Icono (emoji)</label>
                        <input type="text" id="areaIcon" placeholder="‚öôÔ∏è" maxlength="4">
                    </div>
                    <div class="form-group">
                        <label>Horizonte de Enfoque</label>
                        <select id="areaHorizon">
                            <option value="h2">H2 ‚Äî √Åreas de Responsabilidad</option>
                            <option value="h3">H3 ‚Äî Metas 1-2 a√±os</option>
                            <option value="h4">H4 ‚Äî Visi√≥n 3-5 a√±os</option>
                            <option value="h5">H5 ‚Äî Prop√≥sito/Misi√≥n</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: WAITING FOR (GTD)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-waiting">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">‚è≥ A la Espera (Delegaciones)</h2>
                    <button class="btn btn-sm" onclick="openWaitingModal()">+ Nueva Delegaci√≥n</button>
                </div>
                <p class="section-desc">Tareas delegadas a terceros pendientes de respuesta. Registra a quien delegaste, fecha limite y haz seguimiento hasta que se complete.</p>
                <div class="panel-body">
                    <div class="waiting-list" id="waitingList">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Waiting For Modal -->
        <div id="waitingModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <span class="close-modal" onclick="closeWaitingModal()">&times;</span>
                <h2 class="modal-title">Nueva Delegaci√≥n</h2>
                <form id="waitingForm">
                    <div class="form-group">
                        <label>Descripci√≥n</label>
                        <input type="text" id="waitingDesc" required placeholder="¬øQu√© se espera?">
                    </div>
                    <div class="form-group">
                        <label>Delegado a</label>
                        <select id="waitingDelegatedTo"></select>
                    </div>
                    <div class="form-group">
                        <label>Fecha l√≠mite (opcional)</label>
                        <input type="date" id="waitingDueDate">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Crear</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: METHODOLOGIES
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-methodologies">
            <div class="methodologies-grid">

                <!-- CODE -->
                <div class="methodology-card meth-code">
                    <div class="methodology-header">
                        <div class="methodology-icon code-icon">üì•</div>
                        <div>
                            <h3>CODE</h3>
                            <span class="methodology-tag">Tiago Forte ‚Äî Building a Second Brain</span>
                        </div>
                    </div>
                    <div class="methodology-body">
                        <p class="meth-desc">Framework para procesar informacion y convertirla en conocimiento accionable. Cada idea pasa por 4 etapas hasta convertirse en un entregable concreto.</p>
                        <div class="meth-steps">
                            <div class="meth-step">
                                <span class="meth-step-icon">üì•</span>
                                <div>
                                    <strong>Capture</strong>
                                    <span>Recopilar ideas, notas y referencias de cualquier fuente.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">üìÇ</span>
                                <div>
                                    <strong>Organize</strong>
                                    <span>Clasificar por proyecto, area o recurso usando PARA.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">üíé</span>
                                <div>
                                    <strong>Distill</strong>
                                    <span>Resumir y extraer lo esencial ‚Äî solo lo que importa.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">üöÄ</span>
                                <div>
                                    <strong>Express</strong>
                                    <span>Crear entregables: manuales, informes, propuestas.</span>
                                </div>
                            </div>
                        </div>
                        <p class="meth-apply"><strong>En VSC:</strong> Las ideas capturadas en el Hub avanzan por estas etapas con apoyo de IA hasta convertirse en documentos operativos.</p>
                        <a href="#ideas" class="meth-link" onclick="navigateToSection('ideas')">Ver Ideas ‚Üí</a>
                    </div>
                </div>

                <!-- PARA Framework -->
                <div class="methodology-card meth-para">
                    <div class="methodology-header">
                        <div class="methodology-icon para-icon">üóÇÔ∏è</div>
                        <div>
                            <h3>PARA</h3>
                            <span class="methodology-tag">Tiago Forte ‚Äî The PARA Method</span>
                        </div>
                    </div>
                    <div class="methodology-body">
                        <p class="meth-desc">Sistema de organizacion universal. Todo el conocimiento de la consultora se clasifica en 4 categorias segun su nivel de accionabilidad.</p>
                        <div class="meth-steps">
                            <div class="meth-step">
                                <span class="meth-step-icon">üéØ</span>
                                <div>
                                    <strong>Projects</strong>
                                    <span>Esfuerzos con fecha limite y resultado concreto.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">üîÑ</span>
                                <div>
                                    <strong>Areas</strong>
                                    <span>Responsabilidades continuas que requieren mantencion.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">üìö</span>
                                <div>
                                    <strong>Resources</strong>
                                    <span>Temas de interes, referencias y materiales de consulta.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">üì¶</span>
                                <div>
                                    <strong>Archive</strong>
                                    <span>Elementos inactivos que se guardan para referencia futura.</span>
                                </div>
                            </div>
                        </div>
                        <p class="meth-apply"><strong>En VSC:</strong> Los 126 Skills son Resources, cada cliente es un Project, y las areas operativas (RRHH, Finanzas, etc.) son Areas de responsabilidad.</p>
                        <a href="#projects" class="meth-link" onclick="navigateToSection('projects')">Ver Proyectos ‚Üí</a>
                    </div>
                </div>

                <!-- GTD -->
                <div class="methodology-card meth-gtd">
                    <div class="methodology-header">
                        <div class="methodology-icon gtd">üß†</div>
                        <div>
                            <h3>GTD</h3>
                            <span class="methodology-tag">David Allen ‚Äî Getting Things Done</span>
                        </div>
                    </div>
                    <div class="methodology-body">
                        <p class="meth-desc">Metodologia de productividad personal. La premisa: tu mente es para tener ideas, no para retenerlas. Externalizamos todo al sistema.</p>
                        <div class="meth-steps">
                            <div class="meth-step">
                                <span class="meth-step-icon">üì•</span>
                                <div>
                                    <strong>Capturar</strong>
                                    <span>Anotar todo lo que llega ‚Äî sin filtrar ni juzgar.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">‚ùì</span>
                                <div>
                                    <strong>Clarificar</strong>
                                    <span>¬øEs accionable? ¬øCual es la proxima accion concreta?</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">üìã</span>
                                <div>
                                    <strong>Organizar</strong>
                                    <span>Asignar contexto: @oficina, @espera, @llamada, etc.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">üëÄ</span>
                                <div>
                                    <strong>Reflexionar</strong>
                                    <span>Revision semanal de listas, proyectos y compromisos.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">‚ö°</span>
                                <div>
                                    <strong>Ejecutar</strong>
                                    <span>Elegir la siguiente accion segun contexto y energia.</span>
                                </div>
                            </div>
                        </div>
                        <p class="meth-apply"><strong>En VSC:</strong> El Tablero GTD organiza ideas por proxima accion, contexto y proyectos activos. La IA sugiere priorizacion.</p>
                        <a href="#gtd-board" class="meth-link" onclick="navigateToSection('gtd-board')">Ver Tablero GTD ‚Üí</a>
                    </div>
                </div>

                <!-- Multi-Agent IA -->
                <div class="methodology-card meth-agents">
                    <div class="methodology-header">
                        <div class="methodology-icon agents-icon">ü§ñ</div>
                        <div>
                            <h3>Multi-Agente IA</h3>
                            <span class="methodology-tag">OpenClaw ‚Äî Ejecucion Autonoma</span>
                        </div>
                    </div>
                    <div class="methodology-body">
                        <p class="meth-desc">Sistema de agentes de IA especializados que ejecutan tareas operativas de forma autonoma, siguiendo los Skills como instrucciones.</p>
                        <div class="meth-steps">
                            <div class="meth-step">
                                <span class="meth-step-icon">üë•</span>
                                <div>
                                    <strong>Staffing</strong>
                                    <span>Dotacion de personal, turnos y cargas de trabajo.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">üìö</span>
                                <div>
                                    <strong>Training</strong>
                                    <span>Planes de capacitacion y evaluacion de competencias.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">üí∞</span>
                                <div>
                                    <strong>Finance</strong>
                                    <span>Presupuesto, OPEX, analisis de costos y proyecciones.</span>
                                </div>
                            </div>
                            <div class="meth-step">
                                <span class="meth-step-icon">üìã</span>
                                <div>
                                    <strong>Compliance</strong>
                                    <span>Auditoria interna, contratos y cumplimiento normativo.</span>
                                </div>
                            </div>
                        </div>
                        <p class="meth-apply"><strong>Flujo:</strong> El usuario solicita una tarea ‚Üí el agente lee el Skill correspondiente ‚Üí genera un entregable ‚Üí pasa a Revision humana.</p>
                        <a href="#revision" class="meth-link" onclick="navigateToSection('revision')">Ver Revision ‚Üí</a>
                    </div>
                </div>

            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SECTION: SKILLS
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-skills">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìö Skills</h2>
                    <div class="panel-controls">
                        <input type="text" id="skillsSearch" placeholder="Buscar skills..." class="search-input" autocomplete="off">
                    </div>
                </div>
                <div class="skills-filters" id="skillsFilters">
                    <button class="skill-filter-chip active" data-group="all">Todas <span class="chip-count" id="countAll">0</span></button>
                    <button class="skill-filter-chip" data-group="engineering">‚öôÔ∏è Ingenier√≠a & Activos <span class="chip-count" id="countEngineering">0</span></button>
                    <button class="skill-filter-chip" data-group="commissioning">üèóÔ∏è Comisionamiento <span class="chip-count" id="countCommissioning">0</span></button>
                    <button class="skill-filter-chip" data-group="compliance">üìã Cumplimiento <span class="chip-count" id="countCompliance">0</span></button>
                    <button class="skill-filter-chip" data-group="workforce">üë• Fuerza Laboral <span class="chip-count" id="countWorkforce">0</span></button>
                    <button class="skill-filter-chip" data-group="knowledge">üìñ Conocimiento <span class="chip-count" id="countKnowledge">0</span></button>
                    <button class="skill-filter-chip" data-group="gtd">üéØ GTD <span class="chip-count" id="countGtd">0</span></button>
                    <button class="skill-filter-chip" data-group="communication">üìù Comunicaci√≥n <span class="chip-count" id="countCommunication">0</span></button>
                    <button class="skill-filter-chip" data-group="ai-dev">ü§ñ IA & Dev <span class="chip-count" id="countAiDev">0</span></button>
                </div>
                <div class="skills-grid" id="skillsGrid">
                    <!-- Skills will be injected here -->
                    <div class="loading-state">Cargando habilidades...</div>
                </div>
                <div class="skills-pagination" id="skillsPagination"></div>
            </div>
        </section>

        <!-- Skill Viewer Modal (with tabs) -->
        <div id="skillModal" class="modal">
            <div class="modal-content" style="max-width: 800px; height: 80vh; display: flex; flex-direction: column;">
                <span class="close-modal" onclick="document.getElementById('skillModal').style.display='none'">&times;</span>
                <h2 id="skillModalTitle" class="modal-title"></h2>
                <input type="hidden" id="skillModalPath">
                <!-- Tabs -->
                <div class="review-tabs" id="skillTabs">
                    <button class="review-tab active" onclick="switchSkillTab('content')">Contenido</button>
                    <button class="review-tab" onclick="switchSkillTab('documents')">Documentos</button>
                    <button class="review-tab" onclick="switchSkillTab('comments')">Comentarios</button>
                </div>
                <!-- Tab Content -->
                <div id="skillTabContent" style="flex: 1; overflow-y: auto; margin-top: 0.5rem;">
                    <div id="skillModalContent"></div>
                </div>
                <div id="skillTabDocuments" style="flex: 1; overflow-y: auto; margin-top: 0.5rem; display: none;">
                    <div id="skillDocsList" class="skill-docs-list"></div>
                    <% if (user && ['admin', 'manager'].includes(user.role)) { %>
                    <div class="skill-doc-upload" id="skillDocUploadArea">
                        <button class="btn btn-sm" id="btnToggleDocUpload" onclick="toggleSkillDocUpload()">+ Subir Documento</button>
                        <div id="skillDocUploadForm" style="display:none;margin-top:10px;">
                            <div style="display:flex;flex-direction:column;gap:8px;">
                                <input type="file" id="skillDocFile" accept=".md,.pdf,.txt,.docx" class="skill-doc-file-input">
                                <input type="text" id="skillDocDescription" placeholder="Descripci√≥n (opcional)" class="search-input-sm" style="width:100%;">
                                <div style="display:flex;gap:8px;align-items:center;">
                                    <button class="btn btn-sm" onclick="uploadSkillDocument()">Subir</button>
                                    <span id="skillDocUploadStatus" style="font-size:0.8rem;color:var(--text-muted);"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <% } %>
                </div>
                <div id="skillTabComments" style="flex: 1; overflow-y: auto; margin-top: 0.5rem; display: none;">
                    <div id="skillCommentsList" class="comments-list"></div>
                    <div class="comment-form" id="skillCommentForm">
                        <div class="comment-form-row">
                            <label class="comment-form-label">Secci√≥n:</label>
                            <select id="skillCommentSection" class="comment-form-select">
                                <option value="">General (todo el skill)</option>
                            </select>
                        </div>
                        <textarea id="skillCommentInput" rows="3" placeholder="Escribe tu comentario o sugerencia de modificaci√≥n..."></textarea>
                        <div class="comment-form-actions">
                            <button class="btn btn-sm" onclick="submitSkillComment()">Enviar Comentario</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: IDEAS
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-ideas">
            <div class="ideas-container">

                <!-- Input Panel -->
                <div class="panel ideas-input-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">üí° Nueva Idea</h2>
                        <span class="mic-status" id="micStatus"></span>
                    </div>
                    <div class="panel-body">
                        <div class="ideas-form">
                            <textarea id="ideaTextarea" class="ideas-textarea"
                                placeholder="Escribe tu idea aqu√≠ o usa el micr√≥fono..." rows="4"></textarea>
                            <div class="ideas-actions">
                                <button type="button" class="btn-mic" id="btnMic" title="Hablar para escribir">
                                    <span class="mic-icon" id="micIcon">üé§</span>
                                    <span class="mic-label" id="micLabel">Micr√≥fono</span>
                                </button>
                                <button type="button" class="btn btn-sm btn-save-idea" id="btnSaveIdea">
                                    Guardar Idea ‚úì
                                </button>
                            </div>
                            <p class="mic-hint" id="micHint">üí° Tip: Ctrl+Enter para guardar r√°pido</p>
                        </div>
                    </div>
                </div>

                <!-- Ideas List -->
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title">üìã Mis Ideas</h2>
                        <div class="ideas-controls">
                            <div class="idea-filters">
                                <button class="filter-chip active" data-ifilter="all">Todos</button>
                                <button class="filter-chip" data-ifilter="captured">üì• Capturadas</button>
                                <button class="filter-chip" data-ifilter="organized">üìÇ Organizadas</button>
                                <button class="filter-chip" data-ifilter="distilled">üíé Destiladas</button>
                                <button class="filter-chip" data-ifilter="expressed">üöÄ Expresadas</button>
                                <button class="filter-chip" data-ifilter="voice">üé§ Voz</button>
                                <button class="filter-chip" data-ifilter="projects">üìÇ Proyectos</button>
                                <button class="filter-chip" data-ifilter="next-actions">üéØ Proximas</button>
                            </div>
                            <!-- GTD Filters Row -->
                            <div class="gtd-filters" id="gtdFilters">
                                <select id="filterContexto" class="gtd-filter-select" onchange="applyGtdFilters()">
                                    <option value="">üìç Contexto</option>
                                </select>
                                <select id="filterEnergia" class="gtd-filter-select" onchange="applyGtdFilters()">
                                    <option value="">‚ö° Energia</option>
                                    <option value="baja">üü¢ Baja</option>
                                    <option value="media">üü° Media</option>
                                    <option value="alta">üî¥ Alta</option>
                                </select>
                                <select id="filterCompromiso" class="gtd-filter-select" onchange="applyGtdFilters()">
                                    <option value="">üìå Compromiso</option>
                                    <option value="comprometida">Comprometida</option>
                                    <option value="esta_semana">Esta Semana</option>
                                    <option value="algun_dia">Algun Dia</option>
                                    <option value="tal_vez">Tal Vez</option>
                                </select>
                                <select id="filterAssignee" class="gtd-filter-select" onchange="applyGtdFilters()">
                                    <option value="">üë§ Responsable</option>
                                </select>
                                <button class="btn-clear-filters" onclick="clearGtdFilters()" title="Limpiar filtros">‚úï</button>
                            </div>
                            <div class="ideas-controls-bottom">
                                <span class="ideas-count" id="ideasCount">0</span>
                                <% if (user && (user.role==='admin' || user.role==='ceo') ) { %>
                                <button class="btn-icon-danger" id="btnDeleteAllIdeas"
                                    title="Borrar TODAS las ideas (Admin)">üóëÔ∏è</button>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body ideas-list" id="ideasList">
                        <div class="loading-sm">
                            <div class="spinner-sm"></div>
                        </div>
                    </div>
                    <!-- Pagination -->
                    <div class="pagination-controls" id="ideasPagination">
                        <button class="pagination-btn" id="ideasPrevPage" disabled>‚Üê Anterior</button>
                        <span class="pagination-info" id="ideasPageInfo">Pagina 1</span>
                        <button class="pagination-btn" id="ideasNextPage">Siguiente ‚Üí</button>
                    </div>
                </div>

            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: CONTEXT (MEMORY)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-context">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üß† Memoria ‚Äî Contexto PARA</h2>
                    <button class="btn btn-sm" onclick="openContextModal()">+ Nuevo Dato</button>
                </div>
                <div class="panel-body">
                    <!-- PARA Explanation -->
                    <div style="padding:10px 14px;margin-bottom:12px;background:rgba(99,102,241,0.06);border:1px solid rgba(99,102,241,0.15);border-radius:8px;font-size:0.82rem;color:var(--text-secondary);line-height:1.6;">
                        <strong style="color:var(--text-primary);">PARA</strong> es un sistema de organizacion universal. Todo el conocimiento se clasifica en 4 categorias segun su nivel de accionabilidad:
                        <strong>Proyectos</strong> (metas con fecha limite),
                        <strong>Areas</strong> (responsabilidades continuas),
                        <strong>Recursos</strong> (temas de interes/referencia),
                        <strong>Archivo</strong> (inactivo pero guardado).
                    </div>
                    <!-- PARA Tabs -->
                    <div class="para-tabs" id="contextParaTabs">
                        <button class="para-tab active" data-para="all">Todos</button>
                        <button class="para-tab" data-para="project">üöÄ Proyectos</button>
                        <button class="para-tab" data-para="area">üìã √Åreas</button>
                        <button class="para-tab" data-para="resource">üìö Recursos</button>
                        <button class="para-tab" data-para="archive">üóÑÔ∏è Archivo</button>
                    </div>
                    <div class="table-responsive">
                        <table class="data-table" id="contextTable">
                            <thead>
                                <tr>
                                    <th>Clave / Tema</th>
                                    <th>Contenido</th>
                                    <th>PARA</th>
                                    <th>CODE</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Context Items -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Context Modal -->
        <div id="contextModal" class="modal">
            <div class="modal-content" style="max-width: 550px;">
                <span class="close-modal" onclick="closeContextModal()">&times;</span>
                <h2 class="modal-title" id="contextModalTitle">Nuevo Dato de Contexto</h2>
                <form id="contextForm">
                    <input type="hidden" id="contextId">
                    <div class="form-group">
                        <label>Clave / T√≠tulo</label>
                        <input type="text" id="contextKey" required placeholder="Ej: Reglas de Reuniones">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Categor√≠a</label>
                            <select id="contextCategory">
                                <option value="core">Core / Reglas</option>
                                <option value="business">Negocio</option>
                                <option value="personal">Personal</option>
                                <option value="preference">Preferencia</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Tipo PARA</label>
                            <select id="contextParaType">
                                <option value="resource">üìö Recurso</option>
                                <option value="project">üöÄ Proyecto</option>
                                <option value="area">üìã √Årea</option>
                                <option value="archive">üóÑÔ∏è Archivo</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>√Årea relacionada (opcional)</label>
                        <select id="contextAreaId">
                            <option value="">‚Äî Ninguna ‚Äî</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Contenido</label>
                        <textarea id="contextContent" rows="5" required
                            placeholder="Describe el conocimiento..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: REPORTABILITY (Per-Consultant Dashboard)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-reportability">

            <!-- Team Summary Strip -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìä Resumen del Equipo ‚Äî Hoy</h2>
                    <span class="report-date" id="reportDate"></span>
                </div>
                <div class="panel-body">
                    <div class="team-summary-strip" id="teamSummaryStrip">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>

            <!-- Consultant Selector -->
            <div class="report-controls">
                <label class="report-label">Consultor:</label>
                <select id="reportUserSelect" class="report-select">
                    <option value="">‚Äî Seleccionar ‚Äî</option>
                </select>
                <button class="btn btn-sm" id="btnLoadChecklist">Ver Checklist</button>
                <button class="btn btn-sm" style="margin-left:auto;" id="btnFullReport">üìã Reporte Completo</button>
            </div>

            <!-- Consultant Checklist -->
            <div class="panel" id="checklistPanel" style="display:none;">
                <div class="panel-header">
                    <h2 class="panel-title" id="checklistTitle">üìã Checklist Diario</h2>
                    <div class="checklist-progress">
                        <span id="checklistProgress">0/0</span>
                        <div class="progress-bar-mini">
                            <div class="progress-bar-fill" id="checklistProgressBar" style="width:0%"></div>
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="checklist-list" id="checklistList">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>

                    <!-- Waiting For section for this user -->
                    <div id="checklistWaiting" style="display:none;">
                        <h3 class="checklist-section-title">‚è≥ Delegaciones Pendientes</h3>
                        <div id="checklistWaitingList"></div>
                    </div>
                </div>
            </div>

            <!-- Full Team Report (expanded view) -->
            <div id="fullReportPanel" style="display:none;">
                <div class="report-cards-grid" id="reportCardsGrid">
                    <!-- Consultant cards injected here -->
                </div>
            </div>

        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: ANALYTICS (Trend Charts)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-analytics">
            <div class="analytics-toolbar">
                <button class="btn btn-sm" id="btnExportData" title="Exportar todos los datos">üì¶ Exportar Datos</button>
                <label class="btn btn-sm" id="btnImportData" title="Importar datos">üì• Importar
                    <input type="file" id="importFileInput" accept=".json" hidden>
                </label>
                <button class="btn btn-sm" id="btnVoiceCommands" title="Comandos de voz">üé§ Voz</button>
            </div>

            <!-- Ideas Trend Chart -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìà Ideas por Dia (30 dias)</h2>
                </div>
                <div class="panel-body">
                    <div class="chart-container" style="position:relative;height:250px;"><canvas id="chartIdeasPerDay"></canvas></div>
                </div>
            </div>

            <!-- Completion Rate Chart -->
            <div class="analytics-row">
                <div class="panel" style="flex:1;">
                    <div class="panel-header">
                        <h2 class="panel-title">üìä Tasa de Completado</h2>
                    </div>
                    <div class="panel-body">
                        <div class="chart-container" style="position:relative;height:250px;"><canvas id="chartCompletionRate"></canvas></div>
                    </div>
                </div>
                <div class="panel" style="flex:1;">
                    <div class="panel-header">
                        <h2 class="panel-title">üè¢ Areas Mas Activas</h2>
                    </div>
                    <div class="panel-body">
                        <div class="chart-container" style="position:relative;height:250px;"><canvas id="chartActiveAreas"></canvas></div>
                    </div>
                </div>
            </div>

            <!-- CODE Flow Pipeline -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üîÑ Pipeline CODE (Capturar ‚Üí Organizar ‚Üí Destilar ‚Üí Expresar)</h2>
                </div>
                <div class="panel-body">
                    <div id="codeFlowPipeline" class="code-flow-pipeline"></div>
                </div>
            </div>

            <!-- Type & Priority Charts -->
            <div class="analytics-row">
                <div class="panel" style="flex:1;">
                    <div class="panel-header">
                        <h2 class="panel-title">üìã Ideas por Tipo</h2>
                    </div>
                    <div class="panel-body">
                        <div class="chart-container" style="position:relative;height:250px;"><canvas id="chartByType"></canvas></div>
                    </div>
                </div>
                <div class="panel" style="flex:1;">
                    <div class="panel-header">
                        <h2 class="panel-title">üéØ Por Prioridad</h2>
                    </div>
                    <div class="panel-body">
                        <div class="chart-container" style="position:relative;height:250px;"><canvas id="chartByPriority"></canvas></div>
                    </div>
                </div>
            </div>

            <!-- User Productivity -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üë• Productividad por Consultor</h2>
                </div>
                <div class="panel-body">
                    <div class="chart-container" style="position:relative;height:200px;"><canvas id="chartUserProductivity"></canvas></div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: AGENTES
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-agents">

            <!-- Business Agents -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üß† Agentes Especializados</h2>
                </div>
                <div class="panel-body">
                    <div class="agents-grid" id="businessAgentsGrid">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>

            <!-- Execution Agents (OpenClaw) -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">ü¶û Agentes de Ejecucion (OpenClaw)</h2>
                </div>
                <div class="panel-body">
                    <div class="agents-grid" id="executionAgentsGrid">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>

        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: OPENCLAW MONITOR
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-openclaw">

            <!-- Explanation Panel -->
            <div class="panel oc-explainer">
                <div class="panel-header">
                    <h2 class="panel-title">Que es OpenClaw?</h2>
                    <button class="panel-action" id="toggleOcExplainer">Ocultar</button>
                </div>
                <div class="panel-body oc-explainer-body" id="ocExplainerBody">
                    <div class="oc-explainer-grid">
                        <div class="oc-explainer-main">
                            <p class="oc-explainer-desc">
                                <strong>OpenClaw</strong> es el pipeline multi-agente de ejecucion de SecondBrain.
                                Cuando una idea pasa a estado <em>"expresada"</em>, OpenClaw la toma y la ejecuta
                                a traves de una cadena de agentes especializados que colaboran para convertirla
                                en codigo funcional.
                            </p>
                            <div class="oc-explainer-flow">
                                <span class="oc-flow-step"><strong>PM</strong> Planifica</span>
                                <span class="oc-flow-arrow">&rarr;</span>
                                <span class="oc-flow-step"><strong>DEV</strong> Desarrolla</span>
                                <span class="oc-flow-arrow">&rarr;</span>
                                <span class="oc-flow-step"><strong>BUILDER</strong> Construye</span>
                                <span class="oc-flow-arrow">&rarr;</span>
                                <span class="oc-flow-step"><strong>QA</strong> Verifica</span>
                                <span class="oc-flow-arrow">&rarr;</span>
                                <span class="oc-flow-step"><strong>REVIEWER</strong> Aprueba</span>
                            </div>
                        </div>
                        <div class="oc-explainer-stages">
                            <h4>Etapas del Pipeline</h4>
                            <ul>
                                <li><span class="oc-stage-dot pending"></span><strong>Pendiente</strong> &mdash; Idea recibida, esperando asignacion</li>
                                <li><span class="oc-stage-dot queued"></span><strong>En Cola</strong> &mdash; Asignada a un agente, esperando turno</li>
                                <li><span class="oc-stage-dot progress"></span><strong>En Progreso</strong> &mdash; Un agente esta trabajando activamente</li>
                                <li><span class="oc-stage-dot developed"></span><strong>Desarrollado</strong> &mdash; Codigo escrito, listo para build</li>
                                <li><span class="oc-stage-dot built"></span><strong>Construido</strong> &mdash; Build exitoso, listo para QA</li>
                                <li><span class="oc-stage-dot reviewing"></span><strong>En Revision</strong> &mdash; QA/Reviewer verificando calidad</li>
                                <li><span class="oc-stage-dot completed"></span><strong>Completado</strong> &mdash; Aprobado y listo para produccion</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pipeline Status -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">ü¶û Pipeline OpenClaw</h2>
                    <button class="btn btn-sm" id="btnRefreshOpenClaw" onclick="loadOpenClawStatus()">üîÑ Refrescar</button>
                </div>
                <div class="panel-body">
                    <div class="code-pipeline" id="openclawPipeline">
                        <div class="pipeline-stage" data-stage="pending">
                            <div class="pipeline-icon">üì•</div>
                            <div class="pipeline-count" id="ocPending">0</div>
                            <div class="pipeline-label">Pendientes</div>
                        </div>
                        <div class="pipeline-arrow">‚Üí</div>
                        <div class="pipeline-stage" data-stage="queued">
                            <div class="pipeline-icon">üìã</div>
                            <div class="pipeline-count" id="ocQueued">0</div>
                            <div class="pipeline-label">En Cola</div>
                        </div>
                        <div class="pipeline-arrow">‚Üí</div>
                        <div class="pipeline-stage" data-stage="in_progress">
                            <div class="pipeline-icon">‚öôÔ∏è</div>
                            <div class="pipeline-count" id="ocInProgress">0</div>
                            <div class="pipeline-label">En Progreso</div>
                        </div>
                        <div class="pipeline-arrow">‚Üí</div>
                        <div class="pipeline-stage" data-stage="developed">
                            <div class="pipeline-icon">üíª</div>
                            <div class="pipeline-count" id="ocDeveloped">0</div>
                            <div class="pipeline-label">Desarrollado</div>
                        </div>
                        <div class="pipeline-arrow">‚Üí</div>
                        <div class="pipeline-stage" data-stage="built">
                            <div class="pipeline-icon">üî®</div>
                            <div class="pipeline-count" id="ocBuilt">0</div>
                            <div class="pipeline-label">Construido</div>
                        </div>
                        <div class="pipeline-arrow">‚Üí</div>
                        <div class="pipeline-stage" data-stage="reviewing">
                            <div class="pipeline-icon">üîç</div>
                            <div class="pipeline-count" id="ocReviewing">0</div>
                            <div class="pipeline-label">En Revision</div>
                        </div>
                        <div class="pipeline-arrow">‚Üí</div>
                        <div class="pipeline-stage" data-stage="completed">
                            <div class="pipeline-icon">‚úÖ</div>
                            <div class="pipeline-count" id="ocCompleted">0</div>
                            <div class="pipeline-label">Completado</div>
                        </div>
                    </div>
                    <!-- Failed/Blocked row -->
                    <div style="display:flex;gap:24px;justify-content:center;margin-top:12px;">
                        <div style="text-align:center;">
                            <span style="color:var(--danger);font-size:1.3rem;font-weight:700;" id="ocFailed">0</span>
                            <div style="font-size:0.75rem;color:var(--text-muted);">‚ùå Fallidos</div>
                        </div>
                        <div style="text-align:center;">
                            <span style="color:var(--warning);font-size:1.3rem;font-weight:700;" id="ocBlocked">0</span>
                            <div style="font-size:0.75rem;color:var(--text-muted);">üö´ Bloqueados</div>
                        </div>
                        <div style="text-align:center;">
                            <span style="color:var(--success);font-size:1.3rem;font-weight:700;" id="ocProjectsBuilt">0</span>
                            <div style="font-size:0.75rem;color:var(--text-muted);">ü§ñ Proyectos</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Status Cards -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">ü§ñ Estado de Agentes</h2>
                </div>
                <div class="panel-body">
                    <div class="stats-row" id="openclawAgents">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity Feed -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìú Actividad Reciente</h2>
                </div>
                <div class="panel-body">
                    <div id="openclawActivity" class="inbox-log-list">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>

        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: REVISION (Consultor)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-revision">

            <!-- Review Stats -->
            <div class="home-stats-strip" id="reviewStatsStrip">
                <div class="hss-item">
                    <span class="hss-num" id="revStatOutputs">‚Äî</span>
                    <span class="hss-label">Outputs</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="revStatPending">‚Äî</span>
                    <span class="hss-label">Pendientes</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="revStatApproved">‚Äî</span>
                    <span class="hss-label">Aprobados</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="revStatChanges">‚Äî</span>
                    <span class="hss-label">Requieren Cambios</span>
                </div>
            </div>

            <!-- Outputs Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìÑ Outputs de Agentes</h2>
                </div>
                <div class="skills-filters" id="reviewOutputFilters">
                    <button class="skill-filter-chip active" data-filter="all" onclick="filterReviewOutputs('all')">Todos <span class="chip-count" id="revChipAll">0</span></button>
                    <button class="skill-filter-chip" data-filter="pending" onclick="filterReviewOutputs('pending')">Pendientes <span class="chip-count" id="revChipPending">0</span></button>
                    <button class="skill-filter-chip" data-filter="approved" onclick="filterReviewOutputs('approved')">Aprobados <span class="chip-count" id="revChipApproved">0</span></button>
                    <button class="skill-filter-chip" data-filter="needs_changes" onclick="filterReviewOutputs('needs_changes')">Requieren Cambios <span class="chip-count" id="revChipChanges">0</span></button>
                </div>
                <div class="panel-body">
                    <div class="review-list" id="reviewOutputsList">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>

            <!-- Skills Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìö Skills (SOPs)</h2>
                    <div class="panel-controls">
                        <input type="text" id="reviewSkillSearch" placeholder="Buscar skill..." class="search-input-sm" autocomplete="off" oninput="filterReviewSkills()">
                    </div>
                </div>
                <div class="skills-filters" id="reviewSkillFilters">
                    <button class="skill-filter-chip active" data-category="all" onclick="filterReviewSkillCategory('all')">Todas <span class="chip-count" id="revSkillAll">0</span></button>
                    <button class="skill-filter-chip" data-category="core" onclick="filterReviewSkillCategory('core')">üß† Core <span class="chip-count" id="revSkillCore">0</span></button>
                    <button class="skill-filter-chip" data-category="customizable" onclick="filterReviewSkillCategory('customizable')">üõ†Ô∏è Customizable <span class="chip-count" id="revSkillCustom">0</span></button>
                    <button class="skill-filter-chip" data-category="integration" onclick="filterReviewSkillCategory('integration')">üîó Integration <span class="chip-count" id="revSkillInteg">0</span></button>
                </div>
                <div class="panel-body">
                    <div class="review-list" id="reviewSkillsList">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                    <div class="skills-pagination" id="reviewSkillsPagination"></div>
                </div>
            </div>

            <!-- Audit Trail Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìã Auditoria</h2>
                    <div class="panel-controls">
                        <button class="btn btn-sm" onclick="loadAuditTrail()">Refrescar</button>
                    </div>
                </div>
                <div class="skills-filters" id="auditFilters">
                    <button class="skill-filter-chip active" data-audit="all" onclick="filterAuditTrail('all')">Todo</button>
                    <button class="skill-filter-chip" data-audit="review" onclick="filterAuditTrail('review')">Revisiones</button>
                    <button class="skill-filter-chip" data-audit="comment" onclick="filterAuditTrail('comment')">Comentarios</button>
                </div>
                <div class="panel-body">
                    <div class="review-list" id="auditTrailList">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>

        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: FEEDBACK
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-feedback">
            <div class="feedback-toolbar">
                <div class="skills-filters" id="feedbackFilters">
                    <button class="skill-filter-chip active" data-fbfilter="all" onclick="filterFeedback('all')">Todos <span class="chip-count" id="fbCountAll">0</span></button>
                    <button class="skill-filter-chip" data-fbfilter="abierto" onclick="filterFeedback('abierto')">Abierto <span class="chip-count" id="fbCountOpen">0</span></button>
                    <button class="skill-filter-chip" data-fbfilter="en_progreso" onclick="filterFeedback('en_progreso')">En Progreso <span class="chip-count" id="fbCountProgress">0</span></button>
                    <button class="skill-filter-chip" data-fbfilter="corregido" onclick="filterFeedback('corregido')">Corregido <span class="chip-count" id="fbCountFixed">0</span></button>
                    <button class="skill-filter-chip" data-fbfilter="resuelto" onclick="filterFeedback('resuelto')">Resuelto <span class="chip-count" id="fbCountResolved">0</span></button>
                </div>
                <button class="btn btn-sm" onclick="downloadFeedback()" title="Descargar todo el feedback">üì• Descargar</button>
                <button class="btn btn-sm btn-primary" onclick="openFeedbackModal()">+ Nuevo Feedback</button>
            </div>

            <div class="feedback-list" id="feedbackList">
                <div class="loading-sm"><div class="spinner-sm"></div></div>
            </div>
        </section>

        <!-- Feedback Modal (supports single + bulk) -->
        <div id="feedbackModal" class="modal">
            <div class="modal-content" style="max-width:680px;">
                <span class="close-modal" onclick="closeFeedbackModal()">&times;</span>
                <h2 class="modal-title">Enviar Feedback</h2>

                <!-- Queued items list -->
                <div id="fbQueueList" style="display:none;margin-bottom:12px;max-height:240px;overflow-y:auto;"></div>

                <form id="feedbackForm">
                    <div class="form-group">
                        <label>Titulo</label>
                        <input type="text" id="fbTitle" required placeholder="Ej: Mejorar filtros de la secci√≥n X">
                    </div>
                    <div class="form-group">
                        <label>Descripcion</label>
                        <textarea id="fbContent" rows="3" required placeholder="Describe tu sugerencia, problema o idea de mejora..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Adjuntos <span style="color:var(--text-muted);font-weight:normal">(solo disponible al enviar 1 feedback)</span></label>
                        <div class="fb-upload-zone" id="fbUploadZone">
                            <input type="file" id="fbFiles" multiple accept="image/*,.pdf,.txt,.docx,.xlsx" style="display:none">
                            <div class="fb-upload-prompt" id="fbUploadPrompt" onclick="document.getElementById('fbFiles').click()">
                                üìé Arrastra archivos aqui o haz clic para seleccionar
                            </div>
                            <div class="fb-upload-previews" id="fbPreviews"></div>
                        </div>
                    </div>
                    <div class="form-group form-row-2col">
                        <div>
                            <label>Categoria</label>
                            <select id="fbCategory">
                                <option value="mejora">Mejora</option>
                                <option value="bug">Bug / Error</option>
                                <option value="feature">Nueva Funcionalidad</option>
                                <option value="otro">Otro</option>
                            </select>
                        </div>
                        <div>
                            <label>Prioridad</label>
                            <select id="fbPriority">
                                <option value="baja">Baja</option>
                                <option value="media" selected>Media</option>
                                <option value="alta">Alta</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions" style="display:flex;gap:8px;flex-wrap:wrap;">
                        <button type="button" class="btn btn-secondary" id="btnQueueFeedback" onclick="queueFeedbackItem()" title="Agregar a la cola y seguir escribiendo">+ Agregar otro</button>
                        <button type="submit" class="btn btn-primary" id="btnSaveFeedback">Enviar Feedback</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Feedback Response Modal -->
        <div id="feedbackRespondModal" class="modal">
            <div class="modal-content" style="max-width:500px;">
                <span class="close-modal" onclick="closeFeedbackRespondModal()">&times;</span>
                <h2 class="modal-title">Responder Feedback</h2>
                <input type="hidden" id="fbRespondId">
                <div class="form-group">
                    <label>Respuesta</label>
                    <textarea id="fbResponseText" rows="4" required placeholder="Escribe tu respuesta..."></textarea>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="submitFeedbackResponse()">Enviar Respuesta</button>
                </div>
            </div>
        </div>

        <!-- Feedback Lightbox -->
        <div id="fbLightbox" class="fb-lightbox" onclick="closeFbLightbox()" style="display:none">
            <img id="fbLightboxImg" src="" alt="Preview">
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             PROFILE MODAL (self-edit)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="profileModal" class="modal">
            <div class="modal-content profile-modal">
                <span class="close-modal" onclick="closeProfileModal()">&times;</span>
                <div class="modal-body">
                    <!-- Avatar + Identity Header -->
                    <div class="profile-header">
                        <div class="profile-avatar-wrapper" onclick="document.getElementById('profileAvatarInput').click()">
                            <div class="profile-avatar-preview" id="profileAvatarPreview"></div>
                            <div class="profile-avatar-overlay">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                            </div>
                            <input type="file" id="profileAvatarInput" accept="image/*" style="display:none">
                        </div>
                        <div class="profile-identity">
                            <span class="profile-username" id="profileUsername"></span>
                            <span class="profile-role-badge" id="profileRole"></span>
                        </div>
                    </div>

                    <!-- Editable Fields -->
                    <form id="profileForm" class="profile-form">
                        <div class="profile-fields-grid">
                            <div class="form-group">
                                <label>Departamento</label>
                                <input type="text" id="profileDepartment" placeholder="Ej: Operaciones">
                            </div>
                            <div class="form-group">
                                <label>Expertise</label>
                                <input type="text" id="profileExpertise" placeholder="Ej: Confiabilidad, Mantenimiento">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary profile-save-btn">Guardar Cambios</button>
                    </form>

                    <!-- Password Section -->
                    <details class="profile-password-details">
                        <summary>Cambiar Contrase√±a</summary>
                        <div class="profile-password-fields">
                            <div class="form-group">
                                <label>Contrase√±a actual</label>
                                <input type="password" id="profileCurrentPw" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            <div class="form-group">
                                <label>Nueva contrase√±a</label>
                                <input type="password" id="profileNewPw" placeholder="M√≠nimo 4 caracteres">
                            </div>
                            <button type="button" class="btn btn-sm" onclick="changeOwnPassword()">Actualizar Contrase√±a</button>
                        </div>
                    </details>

                    <!-- 2FA Section -->
                    <details class="profile-password-details" id="twofa-setup-section">
                        <summary>Autenticacion de Dos Factores (2FA)</summary>
                        <div id="twofaContent" style="padding: 12px 0;">
                            <div style="text-align:center; color:#94a3b8; padding:20px;">Cargando...</div>
                        </div>
                    </details>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: ADMIN USERS
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-admin-users">
            <!-- Stats bar -->
            <div class="au-stats-bar" id="auStatsBar"></div>

            <!-- Controls -->
            <div class="au-controls">
                <div class="au-search-wrap">
                    <svg class="au-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    <input type="text" id="auSearchInput" class="au-search" placeholder="Buscar usuario..." autocomplete="off" oninput="filterAdminUsers()">
                </div>
                <select id="auFilterRole" class="au-filter-select" onchange="filterAdminUsers()">
                    <option value="">Todos los roles</option>
                    <option value="admin">Admin</option>
                    <option value="ceo">CEO</option>
                    <option value="manager">Manager</option>
                    <option value="analyst">Analyst</option>
                    <option value="consultor">Consultor</option>
                    <option value="usuario">Usuario</option>
                    <option value="cliente">Cliente</option>
                </select>
                <button class="au-add-btn" onclick="openUserEditModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
                    Nuevo Usuario
                </button>
            </div>

            <!-- Users table -->
            <div class="au-table-wrap">
                <table class="au-table" id="adminUsersTable">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Email</th>
                            <th>Rol</th>
                            <th>Departamento</th>
                            <th>Expertise</th>
                            <th>Creado</th>
                            <th class="au-th-actions">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="adminUsersTbody">
                        <tr><td colspan="6" style="text-align:center;padding:32px;"><div class="spinner-sm"></div></td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: AUDIT LOG
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-audit-log">
            <h2 class="section-title" style="display:flex;align-items:center;gap:10px;">
                <span>üìã</span> Registro de Auditoria
            </h2>
            <p class="section-subtitle">Eventos de seguridad del sistema ‚Äî logins, cambios de roles, 2FA, bloqueos</p>

            <div style="display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;align-items:center;">
                <select id="auditFilterEvent" class="au-filter-select" onchange="loadAuditLog()" style="min-width:160px;">
                    <option value="">Todos los eventos</option>
                    <option value="login_success">Login exitoso</option>
                    <option value="login_failure">Login fallido</option>
                    <option value="account_lock">Cuenta bloqueada</option>
                    <option value="account_unlock">Cuenta desbloqueada</option>
                    <option value="password_change">Cambio de password</option>
                    <option value="2fa_enable">2FA activado</option>
                    <option value="2fa_disable">2FA desactivado</option>
                    <option value="2fa_success">2FA exitoso</option>
                    <option value="2fa_failure">2FA fallido</option>
                    <option value="user_create">Usuario creado</option>
                    <option value="user_delete">Usuario eliminado</option>
                    <option value="role_change">Cambio de rol</option>
                    <option value="enforce_2fa">2FA forzado</option>
                    <option value="api_key_create">API key creada</option>
                    <option value="api_key_delete">API key eliminada</option>
                </select>
                <input type="text" id="auditFilterActor" class="au-search" placeholder="Actor..." autocomplete="off" oninput="loadAuditLog()" style="max-width:150px;">
                <input type="date" id="auditFilterFrom" class="au-search" onchange="loadAuditLog()" style="max-width:160px;">
                <input type="date" id="auditFilterTo" class="au-search" onchange="loadAuditLog()" style="max-width:160px;">
            </div>

            <div class="au-table-wrap">
                <table class="au-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Evento</th>
                            <th>Actor</th>
                            <th>Objetivo</th>
                            <th>IP</th>
                            <th>Detalles</th>
                        </tr>
                    </thead>
                    <tbody id="auditLogTbody">
                        <tr><td colspan="6" style="text-align:center;padding:32px;color:var(--text-muted);">Selecciona filtros o carga la seccion</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: ADMIN FILE MANAGER
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-admin-files">
            <h2 class="section-title" style="display:flex;align-items:center;gap:10px;">
                <span>üìÇ</span> Gestor de Archivos
            </h2>
            <p class="section-subtitle">Todos los archivos del sistema ‚Äî subidos, eliminados y papelera de reciclaje</p>

            <!-- Summary bar -->
            <div id="afSummary" style="display:flex;gap:16px;margin-bottom:20px;flex-wrap:wrap;">
                <div style="display:flex;align-items:center;gap:10px;padding:14px 20px;background:var(--bg-panel);border:1px solid var(--border);border-radius:10px;flex:1;min-width:140px;">
                    <span style="font-size:1.4rem;">üìÑ</span>
                    <div><div style="font-size:1.2rem;font-weight:700;color:var(--text-primary);line-height:1.2;" id="afStatTotal">‚Äî</div><div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.04em;">Archivos</div></div>
                </div>
                <div style="display:flex;align-items:center;gap:10px;padding:14px 20px;background:var(--bg-panel);border:1px solid var(--border);border-radius:10px;flex:1;min-width:140px;">
                    <span style="font-size:1.4rem;">üíæ</span>
                    <div><div style="font-size:1.2rem;font-weight:700;color:var(--text-primary);line-height:1.2;" id="afStatSize">‚Äî</div><div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.04em;">Almacenamiento</div></div>
                </div>
                <div style="display:flex;align-items:center;gap:10px;padding:14px 20px;background:var(--bg-panel);border:1px solid var(--border);border-radius:10px;flex:1;min-width:140px;">
                    <span style="font-size:1.4rem;">üóëÔ∏è</span>
                    <div><div style="font-size:1.2rem;font-weight:700;color:var(--text-primary);line-height:1.2;" id="afStatTrash">‚Äî</div><div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.04em;">En papelera</div></div>
                </div>
                <div style="display:flex;align-items:center;gap:10px;padding:14px 20px;background:var(--bg-panel);border:1px solid var(--border);border-radius:10px;flex:1;min-width:140px;">
                    <span style="font-size:1.4rem;">‚ö°</span>
                    <div><div style="font-size:1.2rem;font-weight:700;color:var(--text-primary);line-height:1.2;" id="afStatDynamic">‚Äî</div><div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.04em;">Dinamicas</div></div>
                </div>
            </div>

            <!-- Tabs + search -->
            <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px;flex-wrap:wrap;">
                <div style="display:flex;gap:6px;">
                    <button class="filter-chip active" id="afTabActive" onclick="switchAdminFilesTab('active')">Archivos activos <span id="afTabActiveCount" style="background:rgba(255,255,255,0.2);padding:1px 7px;border-radius:10px;font-size:0.7rem;margin-left:4px;"></span></button>
                    <button class="filter-chip" id="afTabTrash" onclick="switchAdminFilesTab('trash')">Papelera <span id="afTabTrashCount" style="background:rgba(255,255,255,0.15);padding:1px 7px;border-radius:10px;font-size:0.7rem;margin-left:4px;"></span></button>
                </div>
                <div id="afSearchWrap" style="position:relative;max-width:280px;flex:1;">
                    <input type="text" id="afSearchInput" placeholder="Buscar archivos..." autocomplete="off" oninput="filterAdminFiles()" style="width:100%;padding:8px 12px;background:var(--bg-panel);border:1px solid var(--border);border-radius:8px;color:var(--text-primary);font-size:0.84rem;outline:none;">
                </div>
            </div>

            <!-- Active files table -->
            <div id="afActivePanel">
                <div class="au-table-wrap" style="overflow-x:auto;">
                    <table class="au-table">
                        <thead>
                            <tr>
                                <th>Archivo</th>
                                <th style="width:60px;">Tipo</th>
                                <th style="width:80px;">Tamano</th>
                                <th style="width:100px;">Fecha</th>
                                <th style="width:130px;text-align:right;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="afActiveTbody">
                            <tr><td colspan="5" style="text-align:center;padding:32px;color:var(--text-muted);">Cargando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Trash panel -->
            <div id="afTrashPanel" style="display:none;">
                <div class="au-table-wrap" style="overflow-x:auto;">
                    <table class="au-table">
                        <thead>
                            <tr>
                                <th>Archivo original</th>
                                <th style="width:60px;">Tipo</th>
                                <th style="width:80px;">Tamano</th>
                                <th style="width:120px;">Eliminado</th>
                                <th style="width:80px;text-align:right;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="afTrashTbody">
                            <tr><td colspan="5" style="text-align:center;padding:32px;color:var(--text-muted);">Cargando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: HERRAMIENTAS CONTRATADAS
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-herramientas">
            <h2 class="section-title">Suscripciones y Licencias</h2>
            <p class="section-subtitle">Suscripciones y licencias de software ‚Äî contexto para el Finance Agent</p>

            <div class="herr-stats" id="herrStats"></div>

            <div style="display:flex; justify-content:flex-end; margin-bottom:1rem;">
                <button class="btn-primary" onclick="openHerramientaModal()">+ Agregar Suscripci√≥n</button>
            </div>

            <div class="herr-table-wrap">
                <table class="herr-table">
                    <thead>
                        <tr>
                            <th>Software</th>
                            <th>Proveedor</th>
                            <th>Categoria</th>
                            <th>Costo</th>
                            <th>Licencias</th>
                            <th>Duracion</th>
                            <th>Vencimiento</th>
                            <th>Renovacion</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="herrTableBody"></tbody>
                </table>
            </div>
        </section>

        <!-- Suscripci√≥n Modal -->
        <div id="herrModal" class="modal" style="display:none;">
            <div class="modal-content" style="max-width:620px;">
                <h3 class="modal-title" id="herrModalTitle">Agregar Suscripci√≥n</h3>
                <span class="close-modal" onclick="closeHerramientaModal()">&times;</span>
                <div class="modal-body">
                    <form id="herrForm" onsubmit="saveHerramienta(event)">
                        <input type="hidden" id="herrId">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nombre *</label>
                                <input type="text" id="herrNombre" required placeholder="Ej: Fireflies.ai">
                            </div>
                            <div class="form-group">
                                <label>Proveedor</label>
                                <input type="text" id="herrProveedor" placeholder="Ej: Fireflies Inc.">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Categoria</label>
                                <select id="herrCategoria">
                                    <option value="Productividad">Productividad</option>
                                    <option value="Infraestructura">Infraestructura</option>
                                    <option value="Comunicaciones">Comunicaciones</option>
                                    <option value="Desarrollo">Desarrollo</option>
                                    <option value="Dise√±o">Dise√±o</option>
                                    <option value="Operaciones">Operaciones</option>
                                    <option value="RRHH">RRHH</option>
                                    <option value="Seguridad">Seguridad</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Estado</label>
                                <select id="herrEstado">
                                    <option value="activo">Activo</option>
                                    <option value="inactivo">Inactivo</option>
                                    <option value="cancelado">Cancelado</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row form-row-3col">
                            <div class="form-group">
                                <label>Costo</label>
                                <input type="number" id="herrCosto" step="0.01" min="0" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label>Frecuencia</label>
                                <select id="herrFrecuencia">
                                    <option value="mensual">Mensual</option>
                                    <option value="anual">Anual</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Moneda</label>
                                <select id="herrMoneda">
                                    <option value="USD">USD</option>
                                    <option value="CLP">CLP</option>
                                    <option value="EUR">EUR</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row form-row-3col">
                            <div class="form-group">
                                <label>Licencias</label>
                                <input type="number" id="herrLicencias" min="1" value="1">
                            </div>
                            <div class="form-group">
                                <label>Duracion Contrato</label>
                                <select id="herrDuracion">
                                    <option value="">Sin especificar</option>
                                    <option value="1 mes">1 mes</option>
                                    <option value="3 meses">3 meses</option>
                                    <option value="6 meses">6 meses</option>
                                    <option value="1 a√±o">1 a√±o</option>
                                    <option value="2 a√±os">2 a√±os</option>
                                    <option value="3 a√±os">3 a√±os</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Fecha Renovacion</label>
                                <input type="date" id="herrFechaRenovacion">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Fecha Inicio Contrato</label>
                                <input type="date" id="herrFechaInicio">
                            </div>
                            <div class="form-group">
                                <label>Fecha Vencimiento</label>
                                <input type="date" id="herrFechaVencimiento">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Notas</label>
                            <textarea id="herrNotas" rows="2" placeholder="Observaciones..."></textarea>
                        </div>
                        <div class="form-actions" style="justify-content:flex-end; gap:10px;">
                            <button type="button" class="btn-secondary" onclick="closeHerramientaModal()">Cancelar</button>
                            <button type="submit" class="btn-primary">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: GRAPH VIEW ‚Äî Vista Gr√°fica Estilo Obsidian
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-graph-view">
            <div class="graph-toolbar">
                <div class="graph-filters" id="graphFilters"></div>
                <div class="graph-controls">
                    <button class="graph-ctrl-btn" onclick="resetGraphZoom()" title="Centrar vista">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
                    </button>
                    <input type="text" class="graph-search" id="graphSearch" placeholder="Buscar nodo..." autocomplete="off" oninput="searchGraphNode(this.value)">
                </div>
            </div>
            <div class="graph-container" id="graphContainer">
                <svg id="graphSvg"></svg>
            </div>
            <div class="graph-legend" id="graphLegend"></div>
            <div class="graph-tooltip" id="graphTooltip"></div>
        </section>

        <!-- User Edit Modal (admin) -->
        <div id="userEditModal" class="modal">
            <div class="modal-content au-modal">
                <div class="au-modal-header">
                    <h2 id="userEditTitle">Nuevo Usuario</h2>
                    <button class="au-modal-close" onclick="closeUserEditModal()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </div>
                <input type="hidden" id="userEditId">
                <div class="au-modal-avatar">
                    <div class="au-avatar-wrap" onclick="document.getElementById('userEditAvatarInput').click()">
                        <div id="userEditAvatarPreview"></div>
                        <div class="au-avatar-overlay">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                        </div>
                    </div>
                    <input type="file" id="userEditAvatarInput" accept="image/*" style="display:none">
                </div>
                <form id="userEditForm" class="au-form">
                    <div class="au-form-grid">
                        <div class="form-group au-form-full">
                            <label>Nombre</label>
                            <input type="text" id="userEditUsername" placeholder="Nombre para mostrar" autocomplete="off">
                        </div>
                        <div class="form-group au-form-full" id="userEditEmailGroup">
                            <label>Correo Electr√≥nico</label>
                            <input type="email" id="userEditEmail" placeholder="nombre@empresa.com" autocomplete="off">
                        </div>
                        <div class="form-group">
                            <label id="userEditPwLabel">Contrase√±a</label>
                            <input type="password" id="userEditPassword" placeholder="M√≠n 4 caracteres" autocomplete="new-password">
                        </div>
                        <div class="form-group">
                            <label>Rol</label>
                            <select id="userEditRole">
                                <option value="usuario">Usuario</option>
                                <option value="cliente">Cliente</option>
                                <option value="analyst">Analyst</option>
                                <option value="consultor">Consultor</option>
                                <option value="manager">Manager</option>
                                <option value="ceo">CEO</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Departamento</label>
                            <input type="text" id="userEditDepartment" placeholder="Ej: Operaciones">
                        </div>
                        <div class="form-group">
                            <label>Expertise</label>
                            <input type="text" id="userEditExpertise" placeholder="Ej: HSE, Contratos">
                        </div>
                    </div>
                    <button type="submit" class="au-save-btn" id="btnSaveUser">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        Guardar Cambios
                    </button>
                </form>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: INBOX TRIAGE
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-inbox">
            <!-- Inbox Explainer -->
            <div class="inbox-explainer">
                <div class="inbox-explainer-icon">üì•</div>
                <div>
                    <strong>Bandeja de Entrada ‚Äî Triage Inteligente</strong>
                    <p>Aqu√≠ llegan las ideas capturadas que la IA clasific√≥ autom√°ticamente. Revisa las que tienen baja confianza, confirma o corrige la clasificaci√≥n, y mu√©velas a su destino (Proyecto, √Årea, Recurso o Archivo).</p>
                </div>
            </div>

            <!-- Inbox Stats -->
            <div class="home-stats-strip" id="inboxStatsStrip">
                <div class="hss-item">
                    <span class="hss-num" id="inboxStatTotal">--</span>
                    <span class="hss-label">En Bandeja</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="inboxStatReview">--</span>
                    <span class="hss-label">Requiere Revision</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="inboxStatAuto">--</span>
                    <span class="hss-label">Auto-clasificado</span>
                </div>
            </div>

            <!-- Needs Review Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üîç Requiere Revision</h2>
                    <span class="ideas-count" id="inboxReviewCount">0</span>
                </div>
                <div class="panel-body" id="inboxReviewList">
                    <div class="loading-sm"><div class="spinner-sm"></div></div>
                </div>
            </div>

            <!-- Auto-routed Panel -->
            <div class="panel" style="margin-top:16px;">
                <div class="panel-header">
                    <h2 class="panel-title">‚úÖ Auto-clasificado (confianza >= 60%)</h2>
                    <span class="ideas-count" id="inboxAutoCount">0</span>
                </div>
                <div class="panel-body" id="inboxAutoList" style="max-height:600px;overflow-y:auto;">
                    <div class="loading-sm"><div class="spinner-sm"></div></div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: OKRs ‚Äî Objectives & Key Results
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-okrs">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üéØ Objetivos y Key Results</h2>
                    <button class="btn btn-sm" onclick="openCreateOKR()">+ Nuevo Objetivo</button>
                </div>
                <p class="section-desc">Define objetivos estrategicos y mide el progreso con resultados clave cuantificables. Vincula proyectos, ideas y areas a cada objetivo para alinear el trabajo diario con metas de alto nivel.</p>
                <div class="panel-body" id="okrsList">
                    <div class="loading-sm"><div class="spinner-sm"></div></div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: GTD BOARD ‚Äî Proximas Acciones por Contexto
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-gtd-board">
            <p class="section-desc">Tareas pendientes con proxima accion definida, organizadas por contexto (@computador, @oficina...), nivel de energia, persona responsable o tipo de compromiso. Arrastra tarjetas entre columnas para reclasificar.</p>
            <!-- View Toggle -->
            <div class="gtd-board-toolbar">
                <div class="skills-filters">
                    <button class="skill-filter-chip active" onclick="loadGtdBoard('context')" id="gtdViewContext">üìç Contexto</button>
                    <button class="skill-filter-chip" onclick="loadGtdBoard('energy')" id="gtdViewEnergy">‚ö° Energia</button>
                    <button class="skill-filter-chip" onclick="loadGtdBoard('assignee')" id="gtdViewAssignee">üë§ Persona</button>
                    <button class="skill-filter-chip" onclick="loadGtdBoard('compromiso')" id="gtdViewCompromiso">üìå Compromiso</button>
                </div>
            </div>
            <!-- Effectiveness Summary -->
            <div class="gtd-effectiveness-row" id="gtdEffectiveness">
                <div class="loading-sm"><div class="spinner-sm"></div></div>
            </div>
            <!-- GTD Board Columns -->
            <div class="gtd-board-columns" id="gtdBoardColumns">
                <div class="loading-sm"><div class="spinner-sm"></div></div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: GTD PROJECTS ‚Äî Proyectos con Sub-tareas
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-gtd-projects">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìÇ Proyectos GTD</h2>
                    <span class="ideas-count" id="gtdProjectsCount">0</span>
                </div>
                <p class="section-desc">Proyectos desglosados en sub-tareas con proxima accion definida. Ordenados por prioridad (Alta ‚Üí Media ‚Üí Baja). Cada proyecto muestra su progreso y la siguiente tarea a ejecutar.</p>
                <div class="panel-body" id="gtdProjectsList">
                    <div class="loading-sm"><div class="spinner-sm"></div></div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SECTION: GTD DAILY REPORT
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <section class="dashboard-section" id="section-gtd-report">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìã Reporte Diario</h2>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <select id="briefingUserSelect" style="padding:6px 10px;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-size:0.82rem;">
                            <option value="">General</option>
                        </select>
                        <button class="btn btn-sm" onclick="generateDailyReport()" id="btnDailyReport">üîÑ General</button>
                        <button class="btn btn-sm" onclick="loadSelectedBriefing()" style="background:linear-gradient(135deg,#8b5cf6,#6366f1);">üë§ Briefing Personal</button>
                    </div>
                </div>
                <div class="panel-body">
                    <div id="dailyReportStats" class="gtd-report-stats"></div>
                    <div id="dailyReportContent" class="markdown-body" style="padding:16px;">
                        <p style="color:var(--text-muted);">Selecciona un usuario y haz click en "Briefing Personal" o genera el reporte general.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ====================================================
             SECTION: REUNIONES (Meetings Intelligence)
             ==================================================== -->
        <section class="dashboard-section" id="section-reuniones">

            <!-- Stats Strip -->
            <div class="home-stats-strip" id="reunionesStatsStrip">
                <div class="hss-item">
                    <span class="hss-num" id="reunStatTotal">--</span>
                    <span class="hss-label">Total Reuniones</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="reunStatWeek">--</span>
                    <span class="hss-label">Esta Semana</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="reunStatCompromisos">--</span>
                    <span class="hss-label">Compromisos Totales</span>
                </div>
                <div class="hss-divider"></div>
                <div class="hss-item">
                    <span class="hss-num" id="reunStatWithCompromisos">--</span>
                    <span class="hss-label">Con Compromisos</span>
                </div>
            </div>

            <!-- Email Recipients Management (Admin only) -->
            <% if (user.role === 'admin' || user.role === 'ceo') { %>
            <div class="panel" id="emailRecipientsPanel">
                <div class="panel-header">
                    <h2 class="panel-title">üìß Destinatarios de Reportes</h2>
                    <button class="btn btn-sm btn-primary" onclick="openAddRecipientForm()">+ Agregar Email</button>
                </div>
                <div class="panel-body">
                    <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:12px;">
                        Emails a los que se envian automaticamente los reportes de reuniones procesadas por Fireflies.ai.
                    </p>
                    <!-- Add form (hidden by default) -->
                    <div id="addRecipientForm" style="display:none;margin-bottom:16px;padding:12px;background:var(--bg-secondary);border-radius:8px;">
                        <div style="display:flex;gap:8px;align-items:end;flex-wrap:wrap;">
                            <div style="flex:1;min-width:200px;">
                                <label style="font-size:0.8rem;color:var(--text-muted);display:block;margin-bottom:4px;">Email</label>
                                <input type="email" id="newRecipientEmail" placeholder="correo@ejemplo.com" class="search-input-sm" autocomplete="off" style="width:100%;">
                            </div>
                            <div style="flex:1;min-width:150px;">
                                <label style="font-size:0.8rem;color:var(--text-muted);display:block;margin-bottom:4px;">Nombre (opcional)</label>
                                <input type="text" id="newRecipientName" placeholder="Nombre del destinatario" class="search-input-sm" style="width:100%;">
                            </div>
                            <button class="btn btn-sm btn-primary" onclick="addEmailRecipient()">Guardar</button>
                            <button class="btn btn-sm" onclick="document.getElementById('addRecipientForm').style.display='none'">Cancelar</button>
                        </div>
                    </div>
                    <!-- Recipients list -->
                    <div id="emailRecipientsList">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                </div>
            </div>
            <% } %>

            <!-- Meetings List -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìÖ Reuniones Analizadas</h2>
                    <div class="panel-controls">
                        <input type="text" id="reunionesSearch" placeholder="Buscar reuniones..." class="search-input-sm" autocomplete="off" oninput="filterReuniones()">
                        <input type="date" id="reunionesFrom" class="gtd-filter-select" onchange="filterReuniones()" title="Desde">
                        <input type="date" id="reunionesTo" class="gtd-filter-select" onchange="filterReuniones()" title="Hasta">
                        <select id="reunionesParticipant" class="gtd-filter-select" onchange="filterReuniones()">
                            <option value="">Todos los participantes</option>
                        </select>
                        <button class="btn btn-sm btn-primary" onclick="clearReunionesFilters()" title="Limpiar filtros">Limpiar</button>
                    </div>
                </div>
                <div class="panel-body">
                    <div id="reunionesList">
                        <div class="loading-sm"><div class="spinner-sm"></div></div>
                    </div>
                    <div class="pagination-controls" id="reunionesPagination" style="display:flex;justify-content:center;align-items:center;gap:12px;padding:12px 0;">
                        <button class="btn btn-sm" id="reunionesPrevPage" disabled onclick="reunionesChangePage(-1)">Anterior</button>
                        <span id="reunionesPageInfo" style="color:var(--text-muted);font-size:0.85rem;">Pagina 1</span>
                        <button class="btn btn-sm" id="reunionesNextPage" onclick="reunionesChangePage(1)">Siguiente</button>
                    </div>
                </div>
            </div>

        </section>

    </main>

    <!-- Reunion Detail Modal -->
    <div id="reunionModal" class="modal">
        <div class="modal-content" style="max-width:800px;max-height:85vh;display:flex;flex-direction:column;">
            <span class="close-modal" onclick="document.getElementById('reunionModal').style.display='none'">&times;</span>
            <h2 id="reunionModalTitle" class="modal-title">Detalle de Reunion</h2>
            <div id="reunionModalContent" style="flex:1;overflow-y:auto;padding:1rem;"></div>
        </div>
    </div>

    <!-- Fix Idea Modal (Bouncer ‚Äî human correction) -->
    <div id="fixModal" class="modal">
        <div class="modal-content" style="max-width: 520px;">
            <span class="close-modal" onclick="closeFixModal()">&times;</span>
            <h2 class="modal-title">üîß Corregir Clasificacion</h2>
            <p style="color:var(--text-secondary);font-size:0.85rem;margin-bottom:16px;">La IA tiene baja confianza en esta clasificacion. Ajusta los campos correctos:</p>
            <form id="fixForm">
                <input type="hidden" id="fixIdeaId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo</label>
                        <select id="fixType">
                            <option value="">‚Äî Sin cambio ‚Äî</option>
                            <option value="Tarea">Tarea</option>
                            <option value="Proyecto">Proyecto</option>
                            <option value="Nota">Nota</option>
                            <option value="Meta">Meta</option>
                            <option value="Delegacion">Delegacion</option>
                            <option value="Referencia">Referencia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="fixCategory">
                            <option value="">‚Äî Sin cambio ‚Äî</option>
                            <option value="Operaciones">Operaciones</option>
                            <option value="HSE">HSE</option>
                            <option value="Finanzas">Finanzas</option>
                            <option value="Contratos">Contratos</option>
                            <option value="Ejecucion">Ejecucion</option>
                            <option value="Gestion de Activos">Gestion de Activos</option>
                            <option value="Capacitacion">Capacitacion</option>
                            <option value="Desarrollo Profesional">Desarrollo Profesional</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo PARA</label>
                        <select id="fixParaType">
                            <option value="">‚Äî Sin cambio ‚Äî</option>
                            <option value="project">Proyecto</option>
                            <option value="area">Area</option>
                            <option value="resource">Recurso</option>
                            <option value="archive">Archivo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Prioridad</label>
                        <select id="fixPriority">
                            <option value="">‚Äî Sin cambio ‚Äî</option>
                            <option value="alta">Alta</option>
                            <option value="media">Media</option>
                            <option value="baja">Baja</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Asignar a</label>
                    <select id="fixAssignedTo">
                        <option value="">‚Äî Sin cambio ‚Äî</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Guardar Correccion</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Digest Result Modal -->
    <div id="digestModal" class="modal">
        <div class="modal-content" style="max-width: 700px; max-height: 80vh; display: flex; flex-direction: column;">
            <span class="close-modal" onclick="document.getElementById('digestModal').style.display='none'">&times;</span>
            <h2 class="modal-title">üì¨ Digest ‚Äî Tap on Shoulder</h2>
            <div id="digestContent" style="flex: 1; overflow-y: auto; margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px; white-space: pre-wrap; font-size: 0.9rem; line-height: 1.6;">
            </div>
        </div>
    </div>

    <!-- Agent Result Modal -->
    <div id="agentModal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 85vh; display: flex; flex-direction: column;">
            <span class="close-modal" id="closeAgentModal">&times;</span>
            <h2 id="agentModalTitle" class="modal-title">Resultado del Agente</h2>
            <div id="agentModalContent"
                style="flex: 1; overflow-y: auto; margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                <!-- Markdown content goes here -->
            </div>
        </div>
    </div>

    <!-- Confirm Dialog (replaces native confirm()) -->
    <div id="confirmDialog" class="confirm-overlay" style="display:none;">
        <div class="confirm-box">
            <div class="confirm-icon" id="confirmIcon">‚ö†Ô∏è</div>
            <h3 class="confirm-title" id="confirmTitle">¬øEst√°s seguro?</h3>
            <p class="confirm-msg" id="confirmMsg">Esta acci√≥n no se puede deshacer.</p>
            <div class="confirm-btns">
                <button class="confirm-btn confirm-btn-cancel" id="confirmBtnCancel">Cancelar</button>
                <button class="confirm-btn confirm-btn-ok" id="confirmBtnOk">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Custom Generic Modal (Alert/Confirm/Prompt) -->
    <div id="customModal" class="modal" style="display: none; z-index: 2000;">
        <div class="modal-content" style="max-width: 400px; text-align: center; max-height: 90vh; display: flex; flex-direction: column;">
            <h3 id="customModalTitle" class="modal-title" style="margin-bottom: 12px; flex-shrink: 0;">T√≠tulo</h3>
            <div id="customModalMessage" style="color: var(--text-secondary); margin-bottom: 20px; overflow-y: auto; flex: 1;">Mensaje</div>

            <div id="customModalInputContainer" style="display:none; margin-bottom: 20px;">
                <input type="text" id="customModalInput" class="form-input" placeholder="Escribe aqu√≠..."
                    style="width: 100%;">
            </div>

            <div class="form-actions" style="justify-content: center; gap: 12px;">
                <button id="customModalCancel" class="btn">Cancelar</button>
                <button id="customModalConfirm" class="btn btn-primary">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         FLOATING AI WIDGET
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="aiWidget" class="ai-widget">
        <div class="ai-header">
            <div class="ai-header-title">
                <span>ü§ñ</span>
                <select id="agentSelector" class="agent-selector" title="Seleccionar Agente">
                    <option value="default">Asistente General</option>
                    <option value="staffing">Staffing Agent (Dotaci√≥n)</option>
                    <option value="training">Training Agent (Capacitaci√≥n)</option>
                    <option value="finance">Finance Agent (Presupuesto)</option>
                    <option value="compliance">Compliance Agent (Auditor√≠a)</option>
                </select>
            </div>
            <button id="closeAiBtn" class="ai-close-btn">&times;</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message ai">
                <div class="msg-content">
                    <strong>Asistente ValueStrategy</strong>
                    <p>Hola. Soy tu asistente de operaciones. ¬øEn qu√© te ayudo hoy?</p>
                    <small>Puedo ayudarte a organizar ideas, crear tareas o revisar metodolog√≠as.</small>
                </div>
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" placeholder="Escribe tu mensaje..." autocomplete="off">
            <button id="sendBtn">‚û§</button>
        </div>
    </div>

    <button id="aiToggleBtn" class="ai-toggle-btn" title="Abrir Asistente">
        ü§ñ
    </button>

    <script>
        window.__USER__ = <%- JSON.stringify({ username: user?.username || null, role: user?.role || null, department: user?.department || '', expertise: user?.expertise || '', avatar: user?.avatar || null }).replace(/</g, '\\u003c') %>;
    </script>
    <script src="/js/main.js?v=<%= buildId %>"></script>
    <!-- AI toggle handled by initChat() in main.js -->
</body>

</html>